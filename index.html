<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>WG Archer Run</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
html, body {
    margin:0;
    padding:0;
    height:100%;
    background:#081a2f;
    overflow:hidden;
    font-family:Arial;
    color:white;
}

#gameContainer{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
}

canvas{
    background:linear-gradient(#0b2240,#06152a);
    width:100%;
    height:100%;
}
</style>
</head>
<body>

<div id="gameContainer">
    <canvas id="game"></canvas>
</div>

<script>
Telegram.WebApp.expand();

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const ground = 120;
let gameOver = false;

let player = {
    x: 80,
    y: 0,
    width: 80,
    height: 80,
    velocity: 0,
    gravity: 1.2,
    jump: -20
};

let distance = 0;

let obstacles = [];

const img = new Image();
img.src = "archer.png";

const frameWidth = 853;
const frameHeight = 426; // половина 1280 / 3 примерно
let frameX = 0;

function spawnObstacle(){
    obstacles.push({
        x: canvas.width + 50,
        width:40,
        height:60
    });
}

setInterval(()=>{
    if(!gameOver){
        spawnObstacle();
    }
},1500);

function update(){

    if(gameOver) return;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    distance += 0.2;

    // земля
    ctx.fillStyle="#1e2d44";
    ctx.fillRect(0, canvas.height-ground, canvas.width, ground);

    // игрок физика
    player.velocity += player.gravity;
    player.y += player.velocity;

    if(player.y > 0){
        player.y = 0;
    }

    // спрайт (верхняя строка — бег)
    ctx.drawImage(
        img,
        frameX, 0, frameWidth, frameHeight,
        player.x,
        canvas.height-ground-player.height-player.y,
        player.width,
        player.height
    );

    frameX += frameWidth;
    if(frameX >= frameWidth*3){
        frameX = 0;
    }

    // препятствия
    obstacles.forEach((obs,i)=>{
        obs.x -= 6;

        ctx.fillStyle="red";
        ctx.fillRect(
            obs.x,
            canvas.height-ground-obs.height,
            obs.width,
            obs.height
        );

        if(
            obs.x < player.x + player.width &&
            obs.x + obs.width > player.x &&
            canvas.height-ground-obs.height <
            canvas.height-ground-player.height-player.y + player.height
        ){
            gameOver = true;
        }

        if(obs.x < -50){
            obstacles.splice(i,1);
        }
    });

    // текст
    ctx.fillStyle="white";
    ctx.font="20px Arial";
    ctx.fillText("Дистанция: "+Math.floor(distance)+" м",20,40);

    if(gameOver){
        ctx.fillStyle="rgba(0,0,0,0.6)";
        ctx.fillRect(0,0,canvas.width,canvas.height);

        ctx.fillStyle="white";
        ctx.font="50px Arial";
        ctx.textAlign="center";
        ctx.fillText("GAME OVER",canvas.width/2,canvas.height/2);
    }

    requestAnimationFrame(update);
}

canvas.addEventListener("touchstart",()=>{
    if(gameOver){
        location.reload();
    }else{
        if(player.y===0){
            player.velocity = player.jump;
        }
    }
});

update();
</script>

</body>
</html>
