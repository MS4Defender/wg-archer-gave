<!doctype html>
<html lang="ru">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
Â  <title>WG Archer Run</title>
Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>

Â  <style>
Â  Â  :root{
Â  Â  Â  --bg1:#0b1224;
Â  Â  Â  --bg2:#0f172a;
Â  Â  Â  --panel:rgba(255,255,255,.06);
Â  Â  Â  --text:rgba(255,255,255,.92);
Â  Â  Â  --muted:rgba(255,255,255,.70);
Â  Â  Â  --accent:#60a5fa;
Â  Â  Â  --danger:#ef4444;
Â  Â  Â  --ok:#22c55e;
Â  Â  }

Â  Â  *{box-sizing:border-box}
Â  Â  html,body{height:100%; margin:0; background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:var(--text); font-family:Arial, sans-serif;}
Â  Â  body{overflow:hidden;}

Â  Â  .app{
Â  Â  Â  height:100%;
Â  Â  Â  display:flex;
Â  Â  Â  flex-direction:column;
Â  Â  Â  padding:12px 12px calc(12px + env(safe-area-inset-bottom));
Â  Â  Â  gap:10px;
Â  Â  Â  max-width:980px;
Â  Â  Â  margin:0 auto;
Â  Â  }

Â  Â  header{
Â  Â  Â  display:flex;
Â  Â  Â  flex-direction:column;
Â  Â  Â  gap:8px;
Â  Â  Â  flex:0 0 auto;
Â  Â  }

Â  Â  .titleRow{
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  gap:10px;
Â  Â  Â  font-weight:900;
Â  Â  Â  letter-spacing:.4px;
Â  Â  Â  font-size:22px;
Â  Â  }

Â  Â  .stats{
Â  Â  Â  display:flex;
Â  Â  Â  flex-wrap:wrap;
Â  Â  Â  gap:8px;
Â  Â  }
Â  Â  .chip{
Â  Â  Â  background:var(--panel);
Â  Â  Â  border:1px solid rgba(255,255,255,.08);
Â  Â  Â  padding:8px 10px;
Â  Â  Â  border-radius:12px;
Â  Â  Â  font-size:14px;
Â  Â  Â  color:var(--muted);
Â  Â  Â  display:flex;
Â  Â  Â  gap:8px;
Â  Â  Â  align-items:center;
Â  Â  }
Â  Â  .chip b{color:var(--text); font-weight:800}

Â  Â  .content{
Â  Â  Â  flex:1 1 auto;
Â  Â  Â  display:flex;
Â  Â  Â  flex-direction:column;
Â  Â  Â  gap:10px;
Â  Â  Â  min-height:0;
Â  Â  }

Â  Â  .gameBox{
Â  Â  Â  position:relative;
Â  Â  Â  flex:1 1 auto;
Â  Â  Â  background:linear-gradient(180deg,#0b1224,#0b1224);
Â  Â  Â  border-radius:16px;
Â  Â  Â  overflow:hidden;
Â  Â  Â  border:1px solid rgba(255,255,255,.08);
Â  Â  Â  box-shadow:0 18px 55px rgba(0,0,0,.35);
Â  Â  Â  min-height:260px;
Â  Â  }

Â  Â  canvas{
Â  Â  Â  width:100%;
Â  Â  Â  height:100%;
Â  Â  Â  display:block;
Â  Â  Â  touch-action:manipulation;
Â  Â  }

Â  Â  .controlsRow{
Â  Â  Â  display:flex;
Â  Â  Â  gap:10px;
Â  Â  Â  flex-wrap:wrap;
Â  Â  Â  justify-content:flex-start;
Â  Â  Â  align-items:center;
Â  Â  }

Â  Â  button{
Â  Â  Â  background:var(--accent);
Â  Â  Â  border:none;
Â  Â  Â  color:#071021;
Â  Â  Â  font-weight:900;
Â  Â  Â  padding:10px 14px;
Â  Â  Â  border-radius:14px;
Â  Â  Â  cursor:pointer;
Â  Â  Â  font-size:14px;
Â  Â  }
Â  Â  button.secondary{
Â  Â  Â  background:rgba(255,255,255,.10);
Â  Â  Â  color:var(--text);
Â  Â  Â  border:1px solid rgba(255,255,255,.12);
Â  Â  }

Â  Â  .hint{
Â  Â  Â  color:rgba(255,255,255,.55);
Â  Â  Â  font-size:13px;
Â  Â  Â  line-height:1.35;
Â  Â  }

Â  Â  /* Overlay */
Â  Â  .overlay{
Â  Â  Â  position:absolute;
Â  Â  Â  inset:0;
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  background:rgba(0,0,0,.55);
Â  Â  Â  backdrop-filter: blur(6px);
Â  Â  Â  padding:16px;
Â  Â  }
Â  Â  .card{
Â  Â  Â  width:min(520px, 100%);
Â  Â  Â  background:rgba(15,23,42,.85);
Â  Â  Â  border:1px solid rgba(255,255,255,.12);
Â  Â  Â  border-radius:18px;
Â  Â  Â  padding:16px;
Â  Â  Â  box-shadow:0 18px 55px rgba(0,0,0,.45);
Â  Â  }
Â  Â  .card h2{margin:0 0 8px 0; font-size:20px}
Â  Â  .card p{margin:0 0 12px 0; color:var(--muted); font-size:14px; line-height:1.35}
Â  Â  .big{
Â  Â  Â  font-size:16px;
Â  Â  Â  font-weight:900;
Â  Â  Â  color:var(--text);
Â  Â  }
Â  Â  .row{
Â  Â  Â  display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
Â  Â  }

Â  Â  /* Toast */
Â  Â  .toast{
Â  Â  Â  position:absolute;
Â  Â  Â  left:50%;
Â  Â  Â  bottom:14px;
Â  Â  Â  transform:translateX(-50%);
Â  Â  Â  background:rgba(0,0,0,.70);
Â  Â  Â  border:1px solid rgba(255,255,255,.12);
Â  Â  Â  padding:10px 12px;
Â  Â  Â  border-radius:14px;
Â  Â  Â  font-weight:800;
Â  Â  Â  color:var(--text);
Â  Â  Â  display:none;
Â  Â  Â  z-index:5;
Â  Â  }
Â  Â  .toast.show{display:block;}
Â  Â  .toast.ok{border-color:rgba(34,197,94,.35)}
Â  Â  .toast.bad{border-color:rgba(239,68,68,.35)}

Â  Â  /* small screens */
Â  Â  @media (max-width:520px){
Â  Â  Â  .titleRow{font-size:20px}
Â  Â  Â  .chip{font-size:13px}
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="app">
Â  Â  <header>
Â  Â  Â  <div class="titleRow">ğŸ¹ WG Archer Run</div>
Â  Â  Â  <div class="stats">
Â  Â  Â  Â  <div class="chip">â± <span>Ğ’Ñ€ĞµĞ¼Ñ:</span> <b id="time">0.0</b> <span>ÑĞµĞº</span></div>
Â  Â  Â  Â  <div class="chip">ğŸ <span>Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ:</span> <b id="dist">0</b> <span>Ğ¼</span></div>
Â  Â  Â  Â  <div class="chip">âš¡ <span>Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ:</span> <b id="spd">1.0</b><span>x</span></div>
Â  Â  Â  Â  <div class="chip">ğŸ† <span>Ğ ĞµĞºĞ¾Ñ€Ğ´:</span> <b id="best">0</b> <span>Ğ¼</span></div>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <div class="content">
Â  Â  Â  <div class="controlsRow">
Â  Â  Â  Â  <button id="btnPlay">â–¶ Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ</button>
Â  Â  Â  Â  <button id="btnReset" class="secondary">â†» Ğ¡Ğ±Ñ€Ğ¾Ñ</button>
Â  Â  Â  Â  <div class="hint">
Â  Â  Â  Â  Â  Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: <b>Ñ‚Ğ°Ğ¿</b> / <b>ĞºĞ»Ğ¸Ğº</b> / <b>Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»</b> â€” Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº. <br/>
Â  Â  Â  Â  Â  ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹ ÑÑ‡Ğ¸Ñ‚Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸ (Ğ¼ĞµÑ‚Ñ€Ñ‹). ĞŸĞ¾Ğ·Ğ¶Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ğ¼ Ğº Ğ±Ğ¾Ñ‚Ñƒ.
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="gameBox" id="gameBox">
Â  Â  Â  Â  <canvas id="cv"></canvas>

Â  Â  Â  Â  <div class="toast" id="toast"></div>

Â  Â  Â  Â  <div class="overlay" id="overlayStart">
Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <h2>Ğ“Ğ¾Ñ‚Ğ¾Ğ²?</h2>
Â  Â  Â  Â  Â  Â  <p>ĞŸÑ€Ñ‹Ğ³Ğ°Ğ¹ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ. ĞÑˆĞ¸Ğ±ÑÑ â€” ÑĞ¼ĞµÑ€Ñ‚ÑŒ, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑˆÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾.</p>
Â  Â  Â  Â  Â  Â  <p class="big">Ğ¦ĞµĞ»ÑŒ: Ğ¿Ñ€Ğ¾Ğ¹Ñ‚Ğ¸ ĞºĞ°Ğº Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ°Ğ»ÑŒÑˆĞµ ğŸ</p>
Â  Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  Â  Â  <button id="btnStart2">â–¶ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  Â  <button class="secondary" id="btnCloseTg">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="overlay" id="overlayOver" style="display:none;">
Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <h2>ğŸ’€ Game Over</h2>
Â  Â  Â  Â  Â  Â  <p>Ğ¢Ñ‹ Ğ²Ñ€ĞµĞ·Ğ°Ğ»ÑÑ. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:</p>
Â  Â  Â  Â  Â  Â  <p class="big">ğŸ <span id="overDist">0</span> Ğ¼ â€¢ â± <span id="overTime">0.0</span> ÑĞµĞº</p>
Â  Â  Â  Â  Â  Â  <p class="big">ğŸ ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: +<span id="overCoins">0</span> Ğ¼Ğ¾Ğ½ĞµÑ‚</p>
Â  Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  Â  Â  <button id="btnRetry">â–¶ Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ ĞµÑ‰Ñ‘</button>
Â  Â  Â  Â  Â  Â  Â  <button id="btnShare" class="secondary">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

<script>
(() => {
Â  // ===== Telegram WebApp (Ğ½Ğµ Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€) =====
Â  const tg = window.Telegram?.WebApp;
Â  try {
Â  Â  tg?.ready();
Â  Â  tg?.expand();
Â  } catch(e){}

Â  // ===== DOM =====
Â  const cv = document.getElementById('cv');
Â  const ctx = cv.getContext('2d');

Â  const tTime = document.getElementById('time');
Â  const tDist = document.getElementById('dist');
Â  const tSpd Â = document.getElementById('spd');
Â  const tBest = document.getElementById('best');

Â  const overlayStart = document.getElementById('overlayStart');
Â  const overlayOver Â = document.getElementById('overlayOver');

Â  const overDist = document.getElementById('overDist');
Â  const overTime = document.getElementById('overTime');
Â  const overCoins= document.getElementById('overCoins');

Â  const toast = document.getElementById('toast');

Â  // ===== Assets =====
Â  const archerImg = new Image();
Â  archerImg.src = "archer.png"; // <-- Ñ‚Ğ²Ğ¾Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸

Â  // ===== Resize (Ğ²Ğ°Ğ¶Ğ½Ğ¾: canvas Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°) =====
Â  function resize() {
Â  Â  const rect = cv.getBoundingClientRect();
Â  Â  const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
Â  Â  cv.width Â = Math.floor(rect.width * dpr);
Â  Â  cv.height = Math.floor(rect.height * dpr);
Â  Â  ctx.setTransform(dpr,0,0,dpr,0,0); // Ñ€Ğ¸ÑÑƒĞµĞ¼ Ğ² CSS-Ğ¿Ğ¸ĞºÑĞµĞ»ÑÑ…
Â  }
Â  window.addEventListener('resize', resize);
Â  resize();

Â  // ===== Game constants =====
Â  const GROUND_H = 64;
Â  const GRAVITY = 2200; Â  Â  Â  // px/s^2
Â  const JUMP_V Â = 760; Â  Â  Â  Â // px/s
Â  const MAX_FALL= 1400;

Â  // ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¸Ñ€Ğ°
Â  let baseSpeed = 360; Â  Â  Â  Â // px/s
Â  let speedMul Â = 1.0;

Â  // Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹:
Â  const MIN_GAP = 260; Â  Â  Â  Â // Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸ÑĞ¼Ğ¸ (px)
Â  const MAX_GAP = 520; Â  Â  Â  Â // Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ
Â  const MIN_AFTER_BIG = 340; Â // ĞµÑĞ»Ğ¸ Ğ±Ñ‹Ğ» Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ "ÑÑ‚Ğ¾Ğ»Ğ±", Ğ´Ğ°Ñ‘Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¼ĞµÑÑ‚Ğ°

Â  // ===== Rewards by meters (Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑĞµĞ¼) =====
Â  // Ğ’Ñ‹Ğ´Ğ°ĞµÑ‚ÑÑ ĞĞ”Ğ˜Ğ Ğ ĞĞ— Ğ·Ğ° Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ° (Ğ·Ğ° Ñ€Ğ°Ğ½ Ğ² Ğ¸Ğ³Ñ€Ğµ).
Â  const rewardTable = [
Â  Â  { m: 200, Â coins: 50 },
Â  Â  { m: 500, Â coins: 100 },
Â  Â  { m: 1000, coins: 300 },
Â  Â  { m: 2000, coins: 500 },
Â  Â  { m: 4000, coins: 1000 },
Â  Â  { m: 8000, coins: 2000 },
Â  Â  { m: 12000, coins: 5000 } // ÑƒÑĞ»Ğ¾Ğ²Ğ½Ğ¾ "Ğ¾Ñ‡ĞµĞ½ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾"
Â  ];

Â  // ===== State =====
Â  let running = false;
Â  let lastTs = 0;

Â  let timeSec = 0;
Â  let distanceM = 0; Â  Â  Â // Ğ¼ĞµÑ‚Ñ€Ñ‹ (ÑƒÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ)
Â  let bestM = Number(localStorage.getItem('wg_best_m') || 0);

Â  tBest.textContent = bestM;

Â  let coinsEarned = 0;
Â  let rewardsGiven = new Set();

Â  // Player
Â  const player = {
Â  Â  x: 90,
Â  Â  y: 0,
Â  Â  w: 52,
Â  Â  h: 52,
Â  Â  vy: 0,
Â  Â  onGround: true
Â  };

Â  // Obstacles
Â  const obstacles = [];
Â  function groundY() {
Â  Â  // ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ Ğ² CSS-Ğ¿Ğ¸ĞºÑĞµĞ»ÑÑ…
Â  Â  return cv.getBoundingClientRect().height - GROUND_H;
Â  }

Â  function resetRun() {
Â  Â  timeSec = 0;
Â  Â  distanceM = 0;
Â  Â  speedMul = 1.0;
Â  Â  coinsEarned = 0;
Â  Â  rewardsGiven = new Set();

Â  Â  obstacles.length = 0;
Â  Â  player.vy = 0;
Â  Â  player.onGround = true;
Â  Â  player.y = groundY() - player.h;

Â  Â  // ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ Ğ½Ğµ ÑÑ€Ğ°Ğ·Ñƒ Ğ² Ğ»Ğ¸Ñ†Ğ¾
Â  Â  spawnObstacle(520);
Â  Â  spawnObstacle(520 + rand(MIN_GAP, MAX_GAP));
Â  }

Â  // ===== Helpers =====
Â  function rand(a,b){ return a + Math.random()*(b-a); }
Â  function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }

Â  function showToast(text, type="ok", ms=1600){
Â  Â  toast.textContent = text;
Â  Â  toast.className = "toast show " + (type==="bad" ? "bad":"ok");
Â  Â  clearTimeout(showToast._t);
Â  Â  showToast._t = setTimeout(()=>toast.className="toast", ms);
Â  }

Â  // ===== Obstacles logic =====
Â  function spawnObstacle(offsetX) {
Â  Â  const H = cv.getBoundingClientRect().height;
Â  Â  const yGround = groundY();

Â  Â  // Ñ‚Ğ¸Ğ¿: ÑÑ‚Ğ¾Ğ»Ğ± Ğ¸Ğ»Ğ¸ ÑĞ¼Ğ° (Ğ¿Ğ¾ĞºĞ° Ğ¿Ñ€Ğ¾Ñ‰Ğµ â€” ÑÑ‚Ğ¾Ğ»Ğ±Ñ‹)
Â  Â  const isTall = Math.random() < 0.28;

Â  Â  const w = isTall ? 34 : 28;
Â  Â  const h = isTall ? rand(84, 120) : rand(46, 70);

Â  Â  const obs = {
Â  Â  Â  x: (cv.getBoundingClientRect().width + (offsetX || 0)),
Â  Â  Â  y: yGround - h,
Â  Â  Â  w, h,
Â  Â  Â  tall: isTall
Â  Â  };
Â  Â  obstacles.push(obs);
Â  }

Â  function ensureObstacles() {
Â  Â  if (obstacles.length === 0) {
Â  Â  Â  spawnObstacle(520);
Â  Â  Â  return;
Â  Â  }
Â  Â  // ĞµÑĞ»Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğº ĞºÑ€Ğ°Ñ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞµ
Â  Â  const last = obstacles[obstacles.length - 1];
Â  Â  const W = cv.getBoundingClientRect().width;

Â  Â  if (last.x < W + 240) {
Â  Â  Â  const gapBase = rand(MIN_GAP, MAX_GAP);
Â  Â  Â  const gap = last.tall ? Math.max(gapBase, MIN_AFTER_BIG) : gapBase;
Â  Â  Â  spawnObstacle(gap);
Â  Â  }
Â  }

Â  // ===== Collision =====
Â  function rectsOverlap(a,b){
Â  Â  return a.x < b.x + b.w &&
Â  Â  Â  Â  Â  Â a.x + a.w > b.x &&
Â  Â  Â  Â  Â  Â a.y < b.y + b.h &&
Â  Â  Â  Â  Â  Â a.y + a.h > b.y;
Â  }

Â  // ===== Draw =====
Â  function drawBackground() {
Â  Â  const W = cv.getBoundingClientRect().width;
Â  Â  const H = cv.getBoundingClientRect().height;

Â  Â  // Ğ½ĞµĞ±Ğ¾
Â  Â  const g = ctx.createLinearGradient(0,0,0,H);
Â  Â  g.addColorStop(0,"#0b1224");
Â  Â  g.addColorStop(1,"#0f172a");
Â  Â  ctx.fillStyle = g;
Â  Â  ctx.fillRect(0,0,W,H);

Â  Â  // Ğ·ĞµĞ¼Ğ»Ñ
Â  Â  ctx.fillStyle = "rgba(255,255,255,.06)";
Â  Â  ctx.fillRect(0, H - GROUND_H, W, GROUND_H);

Â  Â  // Ğ»Ğ¸Ğ½Ğ¸Ñ
Â  Â  ctx.fillStyle = "rgba(255,255,255,.12)";
Â  Â  ctx.fillRect(0, H - GROUND_H, W, 2);
Â  }

Â  function drawPlayer() {
Â  Â  // ĞµÑĞ»Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ° Ğ½Ğµ ÑƒÑĞ¿ĞµĞ»Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒÑÑ â€” Ñ€Ğ¸ÑÑƒĞµĞ¼ ĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚-Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºÑƒ
Â  Â  if (!archerImg.complete || archerImg.naturalWidth === 0) {
Â  Â  Â  ctx.fillStyle = "#ffffff";
Â  Â  Â  ctx.fillRect(player.x, player.y, player.w, player.h);
Â  Â  Â  return;
Â  Â  }

Â  Â  // Ğ Ğ¸ÑÑƒĞµĞ¼ Ğ°Ñ€Ñ‡ĞµÑ€Ğ° ĞºĞ°Ğº Ğ¾Ğ´Ğ½Ñƒ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºÑƒ (Ğ±ĞµĞ· Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ĞºĞ°)
Â  Â  ctx.drawImage(archerImg, player.x, player.y, player.w, player.h);
Â  }

Â  function drawObstacles() {
Â  Â  ctx.fillStyle = "rgba(255,255,255,.85)";
Â  Â  for (const o of obstacles) {
Â  Â  Â  // Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ° ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğµ ÑĞ¿Ñ€Ğ°Ğ¹Ñ‚Ñ‹
Â  Â  Â  ctx.fillRect(o.x, o.y, o.w, o.h);
Â  Â  }
Â  }

Â  // ===== Rewards =====
Â  function checkRewards() {
Â  Â  for (const r of rewardTable) {
Â  Â  Â  if (distanceM >= r.m && !rewardsGiven.has(r.m)) {
Â  Â  Â  Â  rewardsGiven.add(r.m);
Â  Â  Â  Â  coinsEarned += r.coins;
Â  Â  Â  Â  showToast(`âœ… ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: +${r.coins} Ğ¼Ğ¾Ğ½ĞµÑ‚ (Ğ·Ğ° ${r.m} Ğ¼)`, "ok");
Â  Â  Â  }
Â  Â  }
Â  }

Â  // ===== Main update =====
Â  function update(dt) {
Â  Â  const W = cv.getBoundingClientRect().width;
Â  Â  const H = cv.getBoundingClientRect().height;
Â  Â  const yGround = groundY();

Â  Â  // ÑƒÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ ÑĞ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½ĞµĞ¼ (Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ¼ÑĞ³ĞºĞ¾)
Â  Â  speedMul = 1.0 + Math.min(0.9, timeSec / 90); // Ñ‡ĞµÑ€ĞµĞ· 90 ÑĞµĞº ~1.9x
Â  Â  const worldSpeed = baseSpeed * speedMul;

Â  Â  // Ñ„Ğ¸Ğ·Ğ¸ĞºĞ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°
Â  Â  player.vy += GRAVITY * dt;
Â  Â  player.vy = clamp(player.vy, -99999, MAX_FALL);
Â  Â  player.y += player.vy * dt;

Â  Â  if (player.y >= yGround - player.h) {
Â  Â  Â  player.y = yGround - player.h;
Â  Â  Â  player.vy = 0;
Â  Â  Â  player.onGround = true;
Â  Â  }

Â  Â  // Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹
Â  Â  for (const o of obstacles) o.x -= worldSpeed * dt;

Â  Â  // Ñ‡Ğ¸ÑÑ‚Ğ¸Ğ¼ ÑƒÑˆĞµĞ´ÑˆĞ¸Ğµ
Â  Â  while (obstacles.length && obstacles[0].x + obstacles[0].w < -50) {
Â  Â  Â  obstacles.shift();
Â  Â  }

Â  Â  ensureObstacles();

Â  Â  // ĞºĞ¾Ğ»Ğ»Ğ¸Ğ·Ğ¸Ñ
Â  Â  const pRect = {x: player.x, y: player.y, w: player.w, h: player.h};
Â  Â  for (const o of obstacles) {
Â  Â  Â  if (rectsOverlap(pRect, o)) {
Â  Â  Â  Â  gameOver();
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  }

Â  Â  // Ğ¼ĞµÑ‚Ñ€Ñ‹: ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¸ĞºÑĞµĞ»ĞµĞ¹ (Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾)
Â  Â  // 1 Ğ¼ĞµÑ‚Ñ€ ~ 25px Ğ½Ğ° Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸
Â  Â  distanceM += (worldSpeed * dt) / 25;
Â  Â  timeSec += dt;

Â  Â  // UI
Â  Â  tTime.textContent = timeSec.toFixed(1);
Â  Â  tDist.textContent = Math.floor(distanceM);
Â  Â  tSpd.textContent Â = (speedMul).toFixed(1);

Â  Â  checkRewards();

Â  Â  // draw
Â  Â  drawBackground();
Â  Â  drawObstacles();
Â  Â  drawPlayer();
Â  }

Â  function loop(ts) {
Â  Â  if (!running) return;
Â  Â  const now = ts / 1000;
Â  Â  const prev = lastTs || now;
Â  Â  let dt = now - prev;
Â  Â  lastTs = now;

Â  Â  // Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ»Ğ°Ğ³Ğ¾Ğ²/ÑĞ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ
Â  Â  dt = Math.min(dt, 0.035);

Â  Â  update(dt);
Â  Â  requestAnimationFrame(loop);
Â  }

Â  // ===== Controls =====
Â  function jump() {
Â  Â  if (!running) return;
Â  Â  if (!player.onGround) return;
Â  Â  player.onGround = false;
Â  Â  player.vy = -JUMP_V;
Â  }

Â  function startGame() {
Â  Â  overlayStart.style.display = "none";
Â  Â  overlayOver.style.display Â = "none";
Â  Â  running = true;
Â  Â  lastTs = 0;
Â  Â  resetRun();
Â  Â  requestAnimationFrame(loop);
Â  }

Â  function gameOver() {
Â  Â  running = false;

Â  Â  const d = Math.floor(distanceM);
Â  Â  if (d > bestM) {
Â  Â  Â  bestM = d;
Â  Â  Â  localStorage.setItem('wg_best_m', String(bestM));
Â  Â  Â  tBest.textContent = bestM;
Â  Â  }

Â  Â  overDist.textContent = d;
Â  Â  overTime.textContent = timeSec.toFixed(1);
Â  Â  overCoins.textContent = coinsEarned;

Â  Â  overlayOver.style.display = "flex";
Â  }

Â  function resetAll() {
Â  Â  running = false;
Â  Â  overlayOver.style.display = "none";
Â  Â  overlayStart.style.display = "flex";
Â  Â  tTime.textContent = "0.0";
Â  Â  tDist.textContent = "0";
Â  Â  tSpd.textContent Â = "1.0";
Â  Â  drawBackground();
Â  Â  drawObstacles();
Â  Â  drawPlayer();
Â  }

Â  // ===== Buttons =====
Â  document.getElementById('btnPlay').addEventListener('click', startGame);
Â  document.getElementById('btnStart2').addEventListener('click', startGame);
Â  document.getElementById('btnRetry').addEventListener('click', startGame);

Â  document.getElementById('btnReset').addEventListener('click', resetAll);

Â  document.getElementById('btnCloseTg').addEventListener('click', () => {
Â  Â  try { tg?.close(); } catch(e){}
Â  });

Â  document.getElementById('btnShare').addEventListener('click', () => {
Â  Â  const d = Math.floor(distanceM);
Â  Â  const msg = `ğŸ¹ WG Archer Run\nğŸ Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ: ${d} Ğ¼\nğŸ ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: +${coinsEarned} Ğ¼Ğ¾Ğ½ĞµÑ‚`;
Â  Â  try {
Â  Â  Â  // Ğ’ WebApp Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Ğ±Ğ¾Ñ‚Ğ°:
Â  Â  Â  tg?.sendData(JSON.stringify({ type:"run_result", distance:d, coins:coinsEarned, time: Number(timeSec.toFixed(1)) }));
Â  Â  Â  showToast("ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ±Ğ¾Ñ‚Ñƒ âœ…", "ok");
Â  Â  } catch(e) {
Â  Â  Â  // fallback Ğ´Ğ»Ñ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
Â  Â  Â  navigator.clipboard?.writeText(msg);
Â  Â  Â  showToast("Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ âœ…", "ok");
Â  Â  }
Â  });

Â  // input
Â  window.addEventListener('keydown', (e) => {
Â  Â  if (e.code === 'Space') { e.preventDefault(); jump(); }
Â  });
Â  cv.addEventListener('pointerdown', () => jump());

Â  // ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞ½Ğ´ĞµÑ€
Â  resetAll();
})();
</script>
</body>
</html>
