<!doctype html>
<html lang="ru">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
Â  <title>WG Archer Run</title>
Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>

Â  <style>
Â  Â  :root{
Â  Â  Â  --bg1:#0b1224;
Â  Â  Â  --bg2:#0f172a;
Â  Â  Â  --panel:rgba(255,255,255,.10);
Â  Â  Â  --text:rgba(255,255,255,.92);
Â  Â  Â  --muted:rgba(255,255,255,.72);
Â  Â  Â  --accent:#60a5fa;
Â  Â  Â  --danger:#ef4444;
Â  Â  Â  --ok:#22c55e;
Â  Â  }

Â  Â  *{box-sizing:border-box}
Â  Â  html,body{height:100%; margin:0; background:linear-gradient(180deg,var(--bg1),var(--bg2)); overflow:hidden; font-family:Arial,sans-serif; color:var(--text);}
Â  Â  body{touch-action:manipulation;}

Â  Â  /* Ğ˜Ğ³Ñ€Ğ° Ğ²ÑĞµĞ³Ğ´Ğ° Ğ½Ğ° Ğ²ĞµÑÑŒ ÑĞºÑ€Ğ°Ğ½ Ğ¼Ğ¸Ğ½Ğ¸-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ */
Â  Â  #wrap{
Â  Â  Â  position:fixed;
Â  Â  Â  inset:0;
Â  Â  Â  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
Â  Â  }

Â  Â  #gameBox{
Â  Â  Â  position:absolute;
Â  Â  Â  inset:0;
Â  Â  Â  overflow:hidden;
Â  Â  Â  background:linear-gradient(180deg,#0b1224,#0f172a);
Â  Â  }

Â  Â  canvas{
Â  Â  Â  width:100%;
Â  Â  Â  height:100%;
Â  Â  Â  display:block;
Â  Â  Â  touch-action:manipulation;
Â  Â  }

Â  Â  /* UI Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… Ğ¸Ğ³Ñ€Ñ‹, Ğ½Ğµ Ğ´Ğ²Ğ¸Ğ³Ğ°ĞµÑ‚ canvas */
Â  Â  #hud{
Â  Â  Â  position:absolute;
Â  Â  Â  top:12px;
Â  Â  Â  left:12px;
Â  Â  Â  right:12px;
Â  Â  Â  display:flex;
Â  Â  Â  gap:8px;
Â  Â  Â  flex-wrap:wrap;
Â  Â  Â  align-items:center;
Â  Â  Â  pointer-events:none;
Â  Â  }

Â  Â  .chip{
Â  Â  Â  pointer-events:none;
Â  Â  Â  background:rgba(0,0,0,.35);
Â  Â  Â  border:1px solid rgba(255,255,255,.14);
Â  Â  Â  border-radius:14px;
Â  Â  Â  padding:8px 10px;
Â  Â  Â  font-size:14px;
Â  Â  Â  color:var(--muted);
Â  Â  Â  display:flex;
Â  Â  Â  gap:6px;
Â  Â  Â  align-items:center;
Â  Â  Â  backdrop-filter: blur(6px);
Â  Â  }
Â  Â  .chip b{color:var(--text); font-weight:900}

Â  Â  #controls{
Â  Â  Â  position:absolute;
Â  Â  Â  left:12px;
Â  Â  Â  right:12px;
Â  Â  Â  bottom:12px;
Â  Â  Â  display:flex;
Â  Â  Â  gap:10px;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  pointer-events:auto;
Â  Â  }

Â  Â  button{
Â  Â  Â  background:var(--accent);
Â  Â  Â  border:none;
Â  Â  Â  color:#071021;
Â  Â  Â  font-weight:900;
Â  Â  Â  padding:12px 16px;
Â  Â  Â  border-radius:16px;
Â  Â  Â  cursor:pointer;
Â  Â  Â  font-size:15px;
Â  Â  Â  min-width:140px;
Â  Â  }
Â  Â  button.secondary{
Â  Â  Â  background:rgba(255,255,255,.12);
Â  Â  Â  color:var(--text);
Â  Â  Â  border:1px solid rgba(255,255,255,.16);
Â  Â  }

Â  Â  /* overlays */
Â  Â  .overlay{
Â  Â  Â  position:absolute;
Â  Â  Â  inset:0;
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  background:rgba(0,0,0,.55);
Â  Â  Â  backdrop-filter: blur(6px);
Â  Â  Â  padding:16px;
Â  Â  }
Â  Â  .card{
Â  Â  Â  width:min(560px, 92vw);
Â  Â  Â  background:rgba(15,23,42,.88);
Â  Â  Â  border:1px solid rgba(255,255,255,.14);
Â  Â  Â  border-radius:18px;
Â  Â  Â  padding:16px;
Â  Â  Â  box-shadow:0 18px 55px rgba(0,0,0,.45);
Â  Â  Â  text-align:left;
Â  Â  }
Â  Â  .card h2{margin:0 0 10px 0; font-size:20px}
Â  Â  .card p{margin:0 0 10px 0; color:var(--muted); font-size:14px; line-height:1.35}
Â  Â  .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; justify-content:flex-start;}

Â  Â  /* toast */
Â  Â  #toast{
Â  Â  Â  position:absolute;
Â  Â  Â  left:50%;
Â  Â  Â  bottom:78px;
Â  Â  Â  transform:translateX(-50%);
Â  Â  Â  background:rgba(0,0,0,.75);
Â  Â  Â  border:1px solid rgba(255,255,255,.16);
Â  Â  Â  padding:10px 12px;
Â  Â  Â  border-radius:14px;
Â  Â  Â  font-weight:900;
Â  Â  Â  display:none;
Â  Â  Â  z-index:5;
Â  Â  Â  max-width:92vw;
Â  Â  Â  text-align:center;
Â  Â  }
Â  Â  #toast.show{display:block;}
Â  Â  #toast.ok{border-color:rgba(34,197,94,.38)}
Â  Â  #toast.bad{border-color:rgba(239,68,68,.38)}
Â  </style>
</head>

<body>
Â  <div id="wrap">
Â  Â  <div id="gameBox">
Â  Â  Â  <canvas id="cv"></canvas>

Â  Â  Â  <div id="hud">
Â  Â  Â  Â  <div class="chip">â± <b id="time">0.0</b> <span>ÑĞµĞº</span></div>
Â  Â  Â  Â  <div class="chip">ğŸ <b id="dist">0</b> <span>Ğ¼</span></div>
Â  Â  Â  Â  <div class="chip">âš¡ <b id="spd">1.0</b><span>x</span></div>
Â  Â  Â  Â  <div class="chip">ğŸ† <span>Ğ ĞµĞºĞ¾Ñ€Ğ´:</span> <b id="best">0</b> <span>Ğ¼</span></div>
Â  Â  Â  </div>

Â  Â  Â  <div id="controls">
Â  Â  Â  Â  <button id="btnPlay">â–¶ Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ</button>
Â  Â  Â  Â  <button id="btnReset" class="secondary">â†» Ğ¡Ğ±Ñ€Ğ¾Ñ</button>
Â  Â  Â  </div>

Â  Â  Â  <div id="toast"></div>

Â  Â  Â  <div class="overlay" id="overlayStart">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h2>ğŸ¹ WG Archer Run</h2>
Â  Â  Â  Â  Â  <p>Ğ¢Ğ°Ğ¿ Ğ¿Ğ¾ ÑĞºÑ€Ğ°Ğ½Ñƒ = Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº. ĞÑˆĞ¸Ğ±ÑÑ â€” ÑĞ¼ĞµÑ€Ñ‚ÑŒ, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑˆÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾.</p>
Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  Â  <button id="btnStart2">â–¶ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  <button class="secondary" id="btnCloseTg">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="overlay" id="overlayOver" style="display:none;">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h2>ğŸ’€ Game Over</h2>
Â  Â  Â  Â  Â  <p><b>ğŸ <span id="overDist">0</span> Ğ¼</b> â€¢ â± <span id="overTime">0.0</span> ÑĞµĞº</p>
Â  Â  Â  Â  Â  <p><b>ğŸ ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: +<span id="overCoins">0</span> Ğ¼Ğ¾Ğ½ĞµÑ‚</b></p>
Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  Â  <button id="btnRetry">â–¶ Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ ĞµÑ‰Ñ‘</button>
Â  Â  Â  Â  Â  Â  <button id="btnShare" class="secondary">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  </div>
Â  </div>

<script>
(() => {
Â  // Telegram expand
Â  const tg = window.Telegram?.WebApp;
Â  try {
Â  Â  tg?.ready();
Â  Â  tg?.expand();
Â  } catch(e){}

Â  // DOM
Â  const cv = document.getElementById('cv');
Â  const ctx = cv.getContext('2d');

Â  const tTime = document.getElementById('time');
Â  const tDist = document.getElementById('dist');
Â  const tSpd Â = document.getElementById('spd');
Â  const tBest = document.getElementById('best');

Â  const overlayStart = document.getElementById('overlayStart');
Â  const overlayOver Â = document.getElementById('overlayOver');

Â  const overDist = document.getElementById('overDist');
Â  const overTime = document.getElementById('overTime');
Â  const overCoins= document.getElementById('overCoins');

Â  const toast = document.getElementById('toast');

Â  // ===== Sprite sheet settings (6 ĞºĞ°Ğ´Ñ€Ğ¾Ğ²: 3x2) =====
Â  const SPR_COLS = 3;
Â  const SPR_ROWS = 2;

Â  // Ğ’ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ñ€ÑĞ´: Ğ±ĞµĞ³ (0,1,2)
Â  const RUN_FRAMES = [0,1,2];
Â  const RUN_FPS = 10; // ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ±ĞµĞ³Ğ°

Â  // ĞĞ¸Ğ¶Ğ½Ğ¸Ğ¹ Ñ€ÑĞ´ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ´Ğ»Ñ ÑĞ¼ĞµÑ€Ñ‚Ğ¸ (Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ Ğ½Ğ°Ğ´Ğ¾)
Â  // const DEAD_FRAMES = [3,4,5];

Â  const archerImg = new Image();
Â  archerImg.src = "archer.png";

Â  // Resize canvas (Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€)
Â  function resize() {
Â  Â  const rect = cv.getBoundingClientRect();
Â  Â  const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
Â  Â  cv.width Â = Math.floor(rect.width * dpr);
Â  Â  cv.height = Math.floor(rect.height * dpr);
Â  Â  ctx.setTransform(dpr,0,0,dpr,0,0);
Â  }
Â  window.addEventListener('resize', resize);
Â  resize();

Â  // ===== Game constants =====
Â  const GROUND_H = 70;
Â  const GRAVITY = 2400;
Â  const JUMP_V Â = 780;
Â  const MAX_FALL= 1400;

Â  let baseSpeed = 380;
Â  let speedMul Â = 1.0;

Â  // Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹ (Ğ±ĞµĞ· "Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑÑ‚ĞµĞ½")
Â  const MIN_GAP = 300;
Â  const MAX_GAP = 520;
Â  const MIN_AFTER_TALL = 380;

Â  // Rewards (Ğ¿Ğ¾ Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼, Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€)
Â  const rewardTable = [
Â  Â  { m: 200, Â coins: 50 },
Â  Â  { m: 500, Â coins: 100 },
Â  Â  { m: 1000, coins: 300 },
Â  Â  { m: 2000, coins: 500 },
Â  Â  { m: 4000, coins: 1000 },
Â  Â  { m: 8000, coins: 2000 },
Â  Â  { m: 12000, coins: 5000 }
Â  ];

Â  // State
Â  let running = false;
Â  let lastTs = 0;

Â  let timeSec = 0;
Â  let distanceM = 0;
Â  let coinsEarned = 0;
Â  let rewardsGiven = new Set();

Â  let bestM = Number(localStorage.getItem('wg_best_m') || 0);
Â  tBest.textContent = bestM;

Â  // Player
Â  const player = {
Â  Â  x: 90,
Â  Â  y: 0,
Â  Â  w: 62, Â  Â  // Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ ÑĞ¿Ñ€Ğ°Ğ¹Ñ‚Ğ° Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ
Â  Â  h: 62,
Â  Â  vy: 0,
Â  Â  onGround: true
Â  };

Â  // Obstacles
Â  const obstacles = [];

Â  function W(){ return cv.getBoundingClientRect().width; }
Â  function H(){ return cv.getBoundingClientRect().height; }
Â  function groundY(){ return H() - GROUND_H; }

Â  function rand(a,b){ return a + Math.random()*(b-a); }
Â  function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }

Â  function showToast(text, type="ok", ms=1600){
Â  Â  toast.textContent = text;
Â  Â  toast.className = "";
Â  Â  toast.classList.add("show");
Â  Â  toast.classList.add(type === "bad" ? "bad" : "ok");
Â  Â  clearTimeout(showToast._t);
Â  Â  showToast._t = setTimeout(()=>{ toast.className=""; }, ms);
Â  }

Â  function spawnObstacle(offsetX) {
Â  Â  const yG = groundY();

Â  Â  const tall = Math.random() < 0.30;
Â  Â  const w = tall ? 36 : 30;
Â  Â  const h = tall ? rand(95, 130) : rand(54, 78);

Â  Â  obstacles.push({
Â  Â  Â  x: W() + (offsetX || 0),
Â  Â  Â  y: yG - h,
Â  Â  Â  w, h,
Â  Â  Â  tall
Â  Â  });
Â  }

Â  function ensureObstacles() {
Â  Â  if (!obstacles.length) { spawnObstacle(520); return; }
Â  Â  const last = obstacles[obstacles.length - 1];
Â  Â  if (last.x < W() + 240) {
Â  Â  Â  const gap0 = rand(MIN_GAP, MAX_GAP);
Â  Â  Â  const gap = last.tall ? Math.max(gap0, MIN_AFTER_TALL) : gap0;
Â  Â  Â  spawnObstacle(gap);
Â  Â  }
Â  }

Â  function rectsOverlap(a,b){
Â  Â  return a.x < b.x + b.w &&
Â  Â  Â  Â  Â  Â a.x + a.w > b.x &&
Â  Â  Â  Â  Â  Â a.y < b.y + b.h &&
Â  Â  Â  Â  Â  Â a.y + a.h > b.y;
Â  }

Â  // ===== Drawing =====
Â  function drawBackground() {
Â  Â  const w = W(), h = H();
Â  Â  const g = ctx.createLinearGradient(0,0,0,h);
Â  Â  g.addColorStop(0,"#0b1224");
Â  Â  g.addColorStop(1,"#0f172a");
Â  Â  ctx.fillStyle = g;
Â  Â  ctx.fillRect(0,0,w,h);

Â  Â  // Ğ·ĞµĞ¼Ğ»Ñ
Â  Â  ctx.fillStyle = "rgba(255,255,255,.06)";
Â  Â  ctx.fillRect(0, h - GROUND_H, w, GROUND_H);
Â  Â  ctx.fillStyle = "rgba(255,255,255,.14)";
Â  Â  ctx.fillRect(0, h - GROUND_H, w, 2);
Â  }

Â  function drawObstacles() {
Â  Â  ctx.fillStyle = "rgba(255,255,255,.85)";
Â  Â  for (const o of obstacles) ctx.fillRect(o.x, o.y, o.w, o.h);
Â  }

Â  // Ğ Ğ¸ÑÑƒĞµĞ¼ 1 ĞºĞ°Ğ´Ñ€ ÑĞ¿Ñ€Ğ°Ğ¹Ñ‚Ğ°
Â  function drawSpriteFrame(frameIndex, dx, dy, dw, dh){
Â  Â  if (!archerImg.complete || archerImg.naturalWidth === 0) {
Â  Â  Â  ctx.fillStyle="#fff";
Â  Â  Â  ctx.fillRect(dx,dy,dw,dh);
Â  Â  Â  return;
Â  Â  }

Â  Â  const sw = archerImg.naturalWidth / SPR_COLS;
Â  Â  const sh = archerImg.naturalHeight / SPR_ROWS;

Â  Â  const col = frameIndex % SPR_COLS;
Â  Â  const row = Math.floor(frameIndex / SPR_COLS);

Â  Â  const sx = col * sw;
Â  Â  const sy = row * sh;

Â  Â  ctx.drawImage(archerImg, sx, sy, sw, sh, dx, dy, dw, dh);
Â  }

Â  function drawPlayer(runAnimTime) {
Â  Â  // Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ³Ğ° Ğ¿Ğ¾ ĞºĞ°Ğ´Ñ€Ğ°Ğ¼ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¹ Ğ»Ğ¸Ğ½Ğ¸Ğ¸
Â  Â  const idx = Math.floor(runAnimTime * RUN_FPS) % RUN_FRAMES.length;
Â  Â  const frame = RUN_FRAMES[idx];

Â  Â  drawSpriteFrame(frame, player.x, player.y, player.w, player.h);
Â  }

Â  // ===== Rewards =====
Â  function checkRewards() {
Â  Â  for (const r of rewardTable) {
Â  Â  Â  if (distanceM >= r.m && !rewardsGiven.has(r.m)) {
Â  Â  Â  Â  rewardsGiven.add(r.m);
Â  Â  Â  Â  coinsEarned += r.coins;
Â  Â  Â  Â  showToast(`âœ… +${r.coins} Ğ¼Ğ¾Ğ½ĞµÑ‚ (Ğ·Ğ° ${r.m} Ğ¼)`, "ok");
Â  Â  Â  }
Â  Â  }
Â  }

Â  // ===== Run control =====
Â  function resetRun() {
Â  Â  timeSec = 0;
Â  Â  distanceM = 0;
Â  Â  coinsEarned = 0;
Â  Â  rewardsGiven = new Set();
Â  Â  speedMul = 1.0;

Â  Â  obstacles.length = 0;

Â  Â  player.vy = 0;
Â  Â  player.onGround = true;
Â  Â  player.y = groundY() - player.h;

Â  Â  spawnObstacle(640);
Â  Â  spawnObstacle(640 + rand(MIN_GAP, MAX_GAP));
Â  }

Â  function jump() {
Â  Â  if (!running) return;
Â  Â  if (!player.onGround) return;
Â  Â  player.onGround = false;
Â  Â  player.vy = -JUMP_V;
Â  }

Â  function startGame() {
Â  Â  overlayStart.style.display = "none";
Â  Â  overlayOver.style.display Â = "none";
Â  Â  running = true;
Â  Â  lastTs = 0;
Â  Â  resetRun();
Â  Â  requestAnimationFrame(loop);
Â  }

Â  function gameOver() {
Â  Â  running = false;

Â  Â  const d = Math.floor(distanceM);
Â  Â  if (d > bestM) {
Â  Â  Â  bestM = d;
Â  Â  Â  localStorage.setItem('wg_best_m', String(bestM));
Â  Â  Â  tBest.textContent = bestM;
Â  Â  }

Â  Â  overDist.textContent = d;
Â  Â  overTime.textContent = timeSec.toFixed(1);
Â  Â  overCoins.textContent = coinsEarned;

Â  Â  overlayOver.style.display = "flex";
Â  }

Â  function resetAll() {
Â  Â  running = false;
Â  Â  overlayOver.style.display = "none";
Â  Â  overlayStart.style.display = "flex";

Â  Â  tTime.textContent = "0.0";
Â  Â  tDist.textContent = "0";
Â  Â  tSpd.textContent Â = "1.0";

Â  Â  drawBackground();
Â  Â  drawObstacles();
Â  Â  drawSpriteFrame(0, player.x, groundY()-player.h, player.w, player.h);
Â  }

Â  // ===== Main loop =====
Â  function update(dt) {
Â  Â  // Ğ¼ÑĞ³ĞºĞ¾Ğµ ÑƒÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ (Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ°Ğ´Ğ°)
Â  Â  speedMul = 1.0 + Math.min(0.8, timeSec / 120); // Ñ‡ĞµÑ€ĞµĞ· 120 ÑĞµĞº ~1.8x
Â  Â  const worldSpeed = baseSpeed * speedMul;

Â  Â  // physics
Â  Â  player.vy += GRAVITY * dt;
Â  Â  player.vy = clamp(player.vy, -99999, MAX_FALL);
Â  Â  player.y += player.vy * dt;

Â  Â  const yG = groundY();
Â  Â  if (player.y >= yG - player.h) {
Â  Â  Â  player.y = yG - player.h;
Â  Â  Â  player.vy = 0;
Â  Â  Â  player.onGround = true;
Â  Â  }

Â  Â  // obstacles move
Â  Â  for (const o of obstacles) o.x -= worldSpeed * dt;
Â  Â  while (obstacles.length && obstacles[0].x + obstacles[0].w < -60) obstacles.shift();
Â  Â  ensureObstacles();

Â  Â  // collision
Â  Â  const pRect = {x: player.x, y: player.y, w: player.w, h: player.h};
Â  Â  for (const o of obstacles) {
Â  Â  Â  if (rectsOverlap(pRect, o)) { gameOver(); return; }
Â  Â  }

Â  Â  // meters
Â  Â  distanceM += (worldSpeed * dt) / 25;
Â  Â  timeSec += dt;

Â  Â  // UI
Â  Â  tTime.textContent = timeSec.toFixed(1);
Â  Â  tDist.textContent = Math.floor(distanceM);
Â  Â  tSpd.textContent Â = (speedMul).toFixed(1);

Â  Â  checkRewards();

Â  Â  // draw
Â  Â  drawBackground();
Â  Â  drawObstacles();
Â  Â  drawPlayer(timeSec);
Â  }

Â  function loop(ts) {
Â  Â  if (!running) return;
Â  Â  const now = ts / 1000;
Â  Â  const prev = lastTs || now;
Â  Â  let dt = now - prev;
Â  Â  lastTs = now;
Â  Â  dt = Math.min(dt, 0.035);

Â  Â  update(dt);
Â  Â  requestAnimationFrame(loop);
Â  }

Â  // ===== Controls (Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¢ĞĞŸ) =====
Â  cv.addEventListener('pointerdown', (e) => {
Â  Â  e.preventDefault();
Â  Â  jump();
Â  }, {passive:false});

Â  // Buttons
Â  document.getElementById('btnPlay').addEventListener('click', startGame);
Â  document.getElementById('btnStart2').addEventListener('click', startGame);
Â  document.getElementById('btnRetry').addEventListener('click', startGame);
Â  document.getElementById('btnReset').addEventListener('click', resetAll);

Â  document.getElementById('btnCloseTg').addEventListener('click', () => {
Â  Â  try { tg?.close(); } catch(e){}
Â  });

Â  document.getElementById('btnShare').addEventListener('click', () => {
Â  Â  const d = Math.floor(distanceM);
Â  Â  try {
Â  Â  Â  tg?.sendData(JSON.stringify({
Â  Â  Â  Â  type:"run_result",
Â  Â  Â  Â  distance:d,
Â  Â  Â  Â  coins:coinsEarned,
Â  Â  Â  Â  time:Number(timeSec.toFixed(1))
Â  Â  Â  }));
Â  Â  Â  showToast("ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ±Ğ¾Ñ‚Ñƒ âœ…", "ok");
Â  Â  } catch(e) {
Â  Â  Â  showToast("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ (Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€) â—", "bad");
Â  Â  }
Â  });

Â  // first render
Â  resetAll();
})();
</script>
</body>
</html>
