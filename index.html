<!doctype html>
<html lang="ru">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
Â  <title>WG Archer Run</title>
Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â  <style>
Â  Â  :root{
Â  Â  Â  --bg:#0f172a;
Â  Â  Â  --panel:rgba(0,0,0,.35);
Â  Â  Â  --text:rgba(255,255,255,.92);
Â  Â  Â  --muted:rgba(255,255,255,.70);
Â  Â  Â  --accent:#60a5fa;
Â  Â  }
Â  Â  html,body{height:100%; margin:0; background:var(--bg); color:var(--text); font-family:Arial,sans-serif; overflow:hidden;}
Â  Â  #app{height:100%; display:flex; flex-direction:column;}
Â  Â  header{padding:12px 14px 8px; display:flex; flex-direction:column; gap:10px;}
Â  Â  .title{display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.4px; font-size:22px;}
Â  Â  .stats{display:flex; gap:10px; flex-wrap:wrap; color:var(--muted); font-size:14px;}
Â  Â  .chip{background:var(--panel); padding:7px 10px; border-radius:12px; display:flex; align-items:center; gap:8px;}
Â  Â  .wrap{flex:1; display:flex; align-items:center; justify-content:center; padding:0 10px 12px;}
Â  Â  #gameBox{
Â  Â  Â  width:min(980px, 96vw);
Â  Â  Â  height:min(560px, 64vh);
Â  Â  Â  background:linear-gradient(#0b1224,#0f172a);
Â  Â  Â  border-radius:16px;
Â  Â  Â  box-shadow:0 18px 55px rgba(0,0,0,.45);
Â  Â  Â  overflow:hidden;
Â  Â  Â  position:relative;
Â  Â  }
Â  Â  canvas{width:100%; height:100%; display:block;}
Â  Â  footer{padding:10px 14px 14px; display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; color:var(--muted); font-size:14px;}
Â  Â  button{background:var(--accent); border:none; color:#00122b; font-weight:900; padding:10px 14px; border-radius:12px; cursor:pointer;}
Â  Â  button:active{transform:translateY(1px);}

Â  Â  #overlay{
Â  Â  Â  position:absolute; inset:0;
Â  Â  Â  background:rgba(0,0,0,.55);
Â  Â  Â  display:flex; align-items:center; justify-content:center;
Â  Â  Â  padding:16px;
Â  Â  Â  opacity:0; pointer-events:none;
Â  Â  Â  transition:.15s;
Â  Â  }
Â  Â  #overlay.show{opacity:1; pointer-events:auto;}
Â  Â  .card{
Â  Â  Â  background:rgba(15,23,42,.92);
Â  Â  Â  border:1px solid rgba(255,255,255,.12);
Â  Â  Â  border-radius:16px;
Â  Â  Â  padding:16px;
Â  Â  Â  width:min(420px,92vw);
Â  Â  Â  text-align:center;
Â  Â  }
Â  Â  .card h2{margin:0 0 8px;}
Â  Â  .card .small{color:var(--muted); margin:10px 0 12px;}
Â  Â  .row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap;}

Â  Â  #toast{
Â  Â  Â  position:absolute; left:50%; top:12px; transform:translateX(-50%);
Â  Â  Â  background:rgba(0,0,0,.45);
Â  Â  Â  border:1px solid rgba(255,255,255,.14);
Â  Â  Â  padding:10px 12px; border-radius:12px;
Â  Â  Â  font-weight:900;
Â  Â  Â  opacity:0; transition:.2s; pointer-events:none;
Â  Â  Â  white-space:nowrap;
Â  Â  }
Â  Â  #toast.show{opacity:1;}
Â  </style>
</head>
<body>
<div id="app">
Â  <header>
Â  Â  <div class="title">ğŸ¹ WG Archer Run</div>
Â  Â  <div class="stats">
Â  Â  Â  <div class="chip">â± Ğ’Ñ€ĞµĞ¼Ñ: <span id="time">0.0</span> ÑĞµĞº</div>
Â  Â  Â  <div class="chip">ğŸ Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ: <span id="dist">0</span> Ğ¼</div>
Â  Â  Â  <div class="chip">âš¡ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: <span id="spd">1.0</span>x</div>
Â  Â  </div>
Â  </header>

Â  <div class="wrap">
Â  Â  <div id="gameBox">
Â  Â  Â  <canvas id="cv"></canvas>
Â  Â  Â  <div id="toast">+100 Ğ¼Ğ¾Ğ½ĞµÑ‚</div>

Â  Â  Â  <div id="overlay">
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  <h2>ğŸ’€ Game Over</h2>
Â  Â  Â  Â  Â  <div class="small" id="overText">Ğ¢Ñ‹ Ğ²Ñ€ĞµĞ·Ğ°Ğ»ÑÑ Ğ² Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğµ.</div>
Â  Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  Â  <button id="restartBtn">Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="small">Ğ¢Ğ°Ğ¿/ĞºĞ»Ğ¸Ğº/Ğ¿Ñ€Ğ¾Ğ±ĞµĞ» â€” Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <footer>
Â  Â  <div>Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: Ñ‚Ğ°Ğ¿/ĞºĞ»Ğ¸Ğº/Ğ¿Ñ€Ğ¾Ğ±ĞµĞ» â€” Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº. ĞÑˆĞ¸Ğ±ĞºĞ° â€” ÑĞ¼ĞµÑ€Ñ‚ÑŒ.</div>
Â  Â  <button id="playBtn">â–¶ Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ</button>
Â  </footer>
</div>

<script>
(() => {
Â  // Telegram WebApp
Â  const tg = window.Telegram?.WebApp;
Â  try { tg?.expand(); tg?.ready(); } catch(e) {}

Â  const cv = document.getElementById('cv');
Â  const ctx = cv.getContext('2d');

Â  const $time = document.getElementById('time');
Â  const $dist = document.getElementById('dist');
Â  const $spd Â = document.getElementById('spd');

Â  const playBtn = document.getElementById('playBtn');
Â  const restartBtn = document.getElementById('restartBtn');
Â  const overlay = document.getElementById('overlay');
Â  const overText = document.getElementById('overText');
Â  const toast = document.getElementById('toast');

Â  function resize() {
Â  Â  const rect = cv.getBoundingClientRect();
Â  Â  const dpr = Math.max(1, window.devicePixelRatio || 1);
Â  Â  cv.width Â = Math.floor(rect.width * dpr);
Â  Â  cv.height = Math.floor(rect.height * dpr);
Â  Â  ctx.setTransform(dpr,0,0,dpr,0,0);
Â  }
Â  window.addEventListener('resize', resize);
Â  setTimeout(resize, 30);

Â  // ====== Ğ¡ĞŸĞ ĞĞ™Ğ¢ Ğ›Ğ£Ğ§ĞĞ˜ĞšĞ (SVG Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸, Ğ±ĞµĞ· Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¾Ğº) ======
Â  const archerSVG = `
Â  <svg xmlns="http://www.w3.org/2000/svg" width="120" height="140" viewBox="0 0 120 140">
Â  Â  <defs>
Â  Â  Â  <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
Â  Â  Â  Â  <stop offset="0" stop-color="#f8fafc"/>
Â  Â  Â  Â  <stop offset="1" stop-color="#cbd5e1"/>
Â  Â  Â  </linearGradient>
Â  Â  Â  <filter id="s" x="-20%" y="-20%" width="140%" height="140%">
Â  Â  Â  Â  <feDropShadow dx="0" dy="3" stdDeviation="3" flood-color="#000" flood-opacity=".35"/>
Â  Â  Â  </filter>
Â  Â  </defs>
Â  Â  <g filter="url(#s)">
Â  Â  Â  <!-- hood -->
Â  Â  Â  <path d="M58 18c18 0 30 12 30 26 0 18-16 26-30 26S28 62 28 44c0-14 12-26 30-26z" fill="url(#g)" stroke="#0b1224" stroke-opacity=".35" stroke-width="3"/>
Â  Â  Â  <!-- face -->
Â  Â  Â  <circle cx="58" cy="46" r="10" fill="#0b1224" opacity=".20"/>
Â  Â  Â  <!-- body -->
Â  Â  Â  <path d="M40 70c6-6 34-6 40 0 6 7 10 22 10 42H30c0-20 4-35 10-42z" fill="url(#g)" stroke="#0b1224" stroke-opacity=".35" stroke-width="3"/>
Â  Â  Â  <!-- belt -->
Â  Â  Â  <rect x="34" y="92" width="48" height="10" rx="5" fill="#0b1224" opacity=".25"/>
Â  Â  Â  <!-- legs -->
Â  Â  Â  <rect x="42" y="112" width="14" height="18" rx="5" fill="#e5e7eb"/>
Â  Â  Â  <rect x="60" y="112" width="14" height="18" rx="5" fill="#e5e7eb"/>
Â  Â  Â  <!-- bow -->
Â  Â  Â  <path d="M88 54c10 10 10 34 0 44" fill="none" stroke="#f8fafc" stroke-width="5" stroke-linecap="round"/>
Â  Â  Â  <path d="M88 54c-14 10-14 34 0 44" fill="none" stroke="#94a3b8" stroke-width="3" stroke-linecap="round" opacity=".9"/>
Â  Â  Â  <!-- arrow -->
Â  Â  Â  <path d="M52 76h46" stroke="#f8fafc" stroke-width="3" stroke-linecap="round"/>
Â  Â  Â  <path d="M98 76l-8-5v10z" fill="#f8fafc"/>
Â  Â  </g>
Â  </svg>`;
Â  const archerImg = new Image();
Â  archerImg.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(archerSVG);

Â  // ====== Ğ˜Ğ“Ğ Ğ ======
Â  let running = false;
Â  let lastFrame = 0;

Â  let speed = 260; Â  Â  Â // px/sec
Â  let timeSec = 0;
Â  let distanceM = 0;
Â  let speedMul = 1.0;

Â  let groundY = 0;

Â  const player = { x: 100, y: 0, w: 52, h: 62, vy: 0, onGround: true };

Â  let obstacles = [];
Â  let nextSpawnPx = 0;

Â  const rewardSteps = [
Â  Â  { m: 200, Â coins: 50, Â limit: 40 },
Â  Â  { m: 500, Â coins: 100, limit: 20 },
Â  Â  { m: 1000, coins: 300, limit: 15 },
Â  Â  { m: 2000, coins: 500, limit: 10 },
Â  Â  { m: 3500, coins: 2000, limit: 1 },
Â  Â  { m: 5000, coins: 5000, limit: 1 },
Â  ];
Â  const rewardGiven = Object.fromEntries(rewardSteps.map(r => [r.m, 0]));

Â  function showToast(text){
Â  Â  toast.textContent = text;
Â  Â  toast.classList.add('show');
Â  Â  setTimeout(()=>toast.classList.remove('show'), 1400);
Â  }

Â  function resetGame(){
Â  Â  timeSec=0; distanceM=0; speed=260; speedMul=1.0;
Â  Â  obstacles=[]; nextSpawnPx=0;
Â  Â  overlay.classList.remove('show');

Â  Â  const H = cv.getBoundingClientRect().height;
Â  Â  groundY = Math.floor(H * 0.78);
Â  Â  player.y = groundY - player.h;
Â  Â  player.vy = 0;
Â  Â  player.onGround = true;

Â  Â  $time.textContent="0.0";
Â  Â  $dist.textContent="0";
Â  Â  $spd.textContent="1.0";
Â  }

Â  function die(reason){
Â  Â  running=false;
Â  Â  overText.textContent = reason;
Â  Â  overlay.classList.add('show');
Â  }

Â  function jump(){
Â  Â  if(!running) return;
Â  Â  if(player.onGround){
Â  Â  Â  player.vy = -620;
Â  Â  Â  player.onGround=false;
Â  Â  }
Â  }

Â  function spawnObstacle(){
Â  Â  // Ğ¢ĞĞ›Ğ¬ĞšĞ â€œĞ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğµâ€ ÑĞµÑ€Ğ¸Ğ¸: ÑÑ‚Ğ°Ğ²Ğ¸Ğ¼ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ gap
Â  Â  const kind = Math.random() < 0.78 ? "block" : "pit";

Â  Â  const w = kind==="block" ? (26 + Math.random()*18) : (70 + Math.random()*70);
Â  Â  const h = kind==="block" ? (46 + Math.random()*20) : 22;

Â  Â  const W = cv.getBoundingClientRect().width;
Â  Â  obstacles.push({
Â  Â  Â  kind,
Â  Â  Â  x: W + 40,
Â  Â  Â  w,
Â  Â  Â  h,
Â  Â  Â  y: kind==="block" ? (groundY - h) : groundY
Â  Â  });

Â  Â  // Ğ§ĞµĞ¼ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ â€” Ñ‚ĞµĞ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ gap, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ â€œ5 Ğ¿Ğ¾Ğ´Ñ€ÑĞ´ Ğ±ĞµĞ· ÑˆĞ°Ğ½ÑĞ°â€
Â  Â  const baseGap = 280;
Â  Â  const speedGap = Math.min(260, speed * 0.45);
Â  Â  nextSpawnPx = baseGap + speedGap + Math.random()*140;
Â  }

Â  function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){
Â  Â  return ax < bx+bw && ax+aw > bx && ay < by+bh && ay+ah > by;
Â  }

Â  function checkRewards(){
Â  Â  for(const r of rewardSteps){
Â  Â  Â  if(distanceM >= r.m && rewardGiven[r.m] < r.limit){
Â  Â  Â  Â  rewardGiven[r.m] += 1;
Â  Â  Â  Â  showToast(`âœ… +${r.coins} Ğ¼Ğ¾Ğ½ĞµÑ‚ Ğ·Ğ° ${r.m} Ğ¼`);
Â  Â  Â  Â  try { tg?.sendData(JSON.stringify({type:"reward", meters:r.m, coins:r.coins})); } catch(e){}
Â  Â  Â  }
Â  Â  }
Â  }

Â  function draw(){
Â  Â  const rect = cv.getBoundingClientRect();
Â  Â  const W = rect.width, H = rect.height;

Â  Â  ctx.clearRect(0,0,W,H);

Â  Â  // Ñ„Ğ¾Ğ½
Â  Â  ctx.fillStyle="#0b1224";
Â  Â  ctx.fillRect(0,0,W,H);

Â  Â  // Ğ·ĞµĞ¼Ğ»Ñ
Â  Â  ctx.fillStyle="rgba(255,255,255,.10)";
Â  Â  ctx.fillRect(0,groundY,W,H-groundY);
Â  Â  ctx.strokeStyle="rgba(255,255,255,.12)";
Â  Â  ctx.lineWidth=2;
Â  Â  ctx.beginPath(); ctx.moveTo(0,groundY); ctx.lineTo(W,groundY); ctx.stroke();

Â  Â  // Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ
Â  Â  for(const ob of obstacles){
Â  Â  Â  if(ob.kind==="block"){
Â  Â  Â  Â  ctx.fillStyle="rgba(255,255,255,.22)";
Â  Â  Â  Â  ctx.fillRect(ob.x, ob.y, ob.w, ob.h);
Â  Â  Â  Â  ctx.strokeStyle="rgba(0,0,0,.25)";
Â  Â  Â  Â  ctx.strokeRect(ob.x, ob.y, ob.w, ob.h);
Â  Â  Â  } else {
Â  Â  Â  Â  ctx.fillStyle="rgba(0,0,0,.60)";
Â  Â  Â  Â  ctx.fillRect(ob.x, groundY, ob.w, ob.h);
Â  Â  Â  Â  ctx.strokeStyle="rgba(255,255,255,.10)";
Â  Â  Â  Â  ctx.strokeRect(ob.x, groundY, ob.w, ob.h);
Â  Â  Â  }
Â  Â  }

Â  Â  // Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ (ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ° Ğ»ÑƒÑ‡Ğ½Ğ¸ĞºĞ°)
Â  Â  // Ğ’ĞĞ–ĞĞ: drawImage Ñ€Ğ¸ÑÑƒĞµÑ‚ÑÑ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ² Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾Ğ¹ Ğ·Ğ¾Ğ½Ğµ, Ğ±ĞµĞ· CSS-ÑÑÑ€Ğ¿Ñ€Ğ¸Ğ·Ğ¾Ğ²
Â  Â  if(archerImg.complete){
Â  Â  Â  ctx.drawImage(archerImg, player.x, player.y - 10, player.w + 12, player.h + 18);
Â  Â  } else {
Â  Â  Â  // Ğ·Ğ°Ğ¿Ğ°ÑĞ½Ğ¾Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ (ĞµÑĞ»Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ° ĞµÑ‰Ñ‘ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ³Ñ€ÑƒĞ·Ğ¸Ğ»Ğ°ÑÑŒ)
Â  Â  Â  ctx.fillStyle="#e5e7eb";
Â  Â  Â  ctx.fillRect(player.x, player.y, player.w, player.h);
Â  Â  }
Â  }

Â  function update(dt){
Â  Â  timeSec += dt;
Â  Â  distanceM += (speed * dt) / 10;

Â  Â  // ÑƒÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ
Â  Â  speed += 16 * dt;
Â  Â  speedMul = 1.0 + (speed - 260) / 650;
Â  Â  speedMul = Math.max(1.0, Math.min(3.0, speedMul));

Â  Â  // Ñ„Ğ¸Ğ·Ğ¸ĞºĞ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°
Â  Â  player.vy += 1500 * dt;
Â  Â  player.y += player.vy * dt;

Â  Â  if(player.y >= groundY - player.h){
Â  Â  Â  player.y = groundY - player.h;
Â  Â  Â  player.vy = 0;
Â  Â  Â  player.onGround = true;
Â  Â  }

Â  Â  // ÑĞ¿Ğ°Ğ²Ğ½
Â  Â  nextSpawnPx -= speed * dt;
Â  Â  if(nextSpawnPx <= 0) spawnObstacle();

Â  Â  // Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹
Â  Â  for(const ob of obstacles) ob.x -= speed * dt;
Â  Â  obstacles = obstacles.filter(o => o.x + o.w > -60);

Â  Â  // ÑÑ‚Ğ¾Ğ»ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ñ
Â  Â  for(const ob of obstacles){
Â  Â  Â  if(ob.kind==="block"){
Â  Â  Â  Â  if(rectsOverlap(player.x,player.y,player.w,player.h, ob.x,ob.y,ob.w,ob.h)){
Â  Â  Â  Â  Â  die("Ğ¢Ñ‹ Ğ²Ñ€ĞµĞ·Ğ°Ğ»ÑÑ Ğ² Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğµ.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  const mid = player.x + player.w*0.55;
Â  Â  Â  Â  const inPit = mid > ob.x && mid < (ob.x + ob.w);
Â  Â  Â  Â  if(inPit && player.onGround){
Â  Â  Â  Â  Â  die("Ğ¢Ñ‹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸Ğ»ÑÑ Ğ² ÑĞ¼Ñƒ.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  checkRewards();

Â  Â  $time.textContent = timeSec.toFixed(1);
Â  Â  $dist.textContent = Math.floor(distanceM).toString();
Â  Â  $spd.textContent Â = speedMul.toFixed(1);
Â  }

Â  function loop(now){
Â  Â  if(!running){ draw(); return; }
Â  Â  const dt = Math.min(0.033, (now - lastFrame)/1000);
Â  Â  lastFrame = now;

Â  Â  update(dt);
Â  Â  draw();

Â  Â  if(running) requestAnimationFrame(loop);
Â  }

Â  // ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
Â  window.addEventListener('keydown', (e)=>{ if(e.code==="Space"){ e.preventDefault(); jump(); } }, {passive:false});
Â  cv.addEventListener('pointerdown', ()=>jump());

Â  playBtn.addEventListener('click', ()=>{
Â  Â  resetGame();
Â  Â  running=true;
Â  Â  lastFrame=performance.now();
Â  Â  requestAnimationFrame(loop);
Â  });

Â  restartBtn.addEventListener('click', ()=>{
Â  Â  resetGame();
Â  Â  running=true;
Â  Â  lastFrame=performance.now();
Â  Â  requestAnimationFrame(loop);
Â  });

Â  // ÑÑ‚Ğ°Ñ€Ñ‚
Â  resetGame();
Â  draw();
})();
</script>
</body>
</html>
