<!DOCTYPE html>
<html lang="ru">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
Â  <title>WG Archer Run</title>
Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>

Â  <style>
Â  Â  :root{
Â  Â  Â  --bg:#0f1720;
Â  Â  Â  --panel:#111827;
Â  Â  Â  --text:#e5e7eb;
Â  Â  Â  --muted:#9ca3af;
Â  Â  Â  --accent:#60a5fa;
Â  Â  Â  --danger:#ef4444;
Â  Â  Â  --ground:#1f2937;
Â  Â  Â  --card:#0b1220;
Â  Â  }

Â  Â  *{ box-sizing:border-box; }
Â  Â  html, body{
Â  Â  Â  height:100%;
Â  Â  Â  margin:0;
Â  Â  Â  background:var(--bg);
Â  Â  Â  color:var(--text);
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  overflow:hidden; /* Ğ’ĞĞ–ĞĞ: ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ³Ñ€Ğ° Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ° Ğ²Ğ½Ğ¸Ğ·Ñƒ */
Â  Â  }

Â  Â  #app{
Â  Â  Â  height:100vh;
Â  Â  Â  display:flex;
Â  Â  Â  flex-direction:column;
Â  Â  Â  padding: 14px 14px calc(14px + env(safe-area-inset-bottom));
Â  Â  Â  gap:12px;
Â  Â  }

Â  Â  h1{
Â  Â  Â  margin:0;
Â  Â  Â  font-size:22px;
Â  Â  Â  letter-spacing:0.2px;
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  gap:10px;
Â  Â  }

Â  Â  .top{
Â  Â  Â  display:flex;
Â  Â  Â  align-items:flex-start;
Â  Â  Â  justify-content:space-between;
Â  Â  Â  gap:12px;
Â  Â  Â  flex-wrap:wrap;
Â  Â  }

Â  Â  .stats{
Â  Â  Â  display:flex;
Â  Â  Â  gap:14px;
Â  Â  Â  flex-wrap:wrap;
Â  Â  Â  font-size:14px;
Â  Â  Â  color:var(--muted);
Â  Â  }
Â  Â  .stats b{ color:var(--text); font-weight:700; }

Â  Â  .controls{
Â  Â  Â  display:flex;
Â  Â  Â  gap:10px;
Â  Â  Â  align-items:center;
Â  Â  Â  flex-wrap:wrap;
Â  Â  }

Â  Â  button{
Â  Â  Â  border:0;
Â  Â  Â  padding:10px 14px;
Â  Â  Â  border-radius:10px;
Â  Â  Â  background:#1d4ed8;
Â  Â  Â  color:white;
Â  Â  Â  font-weight:700;
Â  Â  Â  cursor:pointer;
Â  Â  }
Â  Â  button.secondary{
Â  Â  Â  background:#334155;
Â  Â  }

Â  Â  #gameWrap{
Â  Â  Â  flex:1;
Â  Â  Â  min-height: 280px;
Â  Â  Â  background: linear-gradient(180deg, #0b1220, #0b1220);
Â  Â  Â  border-radius:14px;
Â  Â  Â  position:relative;
Â  Â  Â  overflow:hidden;
Â  Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,.35);
Â  Â  Â  border: 1px solid rgba(255,255,255,.06);
Â  Â  }

Â  Â  #ground{
Â  Â  Â  position:absolute;
Â  Â  Â  left:0; right:0;
Â  Â  Â  bottom:0;
Â  Â  Â  height:74px;
Â  Â  Â  background: linear-gradient(180deg, #111827, #0b1220);
Â  Â  Â  border-top:1px solid rgba(255,255,255,.08);
Â  Â  }

Â  Â  /* Ğ˜Ğ³Ñ€Ğ¾Ğº â€” Ğ»ÑƒÑ‡Ğ½Ğ¸Ğº (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ°Ñ, Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ğ°Ñ Ğ¸ĞºĞ¾Ğ½ĞºĞ°) */
Â  Â  #player{
Â  Â  Â  position:absolute;
Â  Â  Â  left:70px;
Â  Â  Â  bottom:74px; /* ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ½Ğ° Ğ·ĞµĞ¼Ğ»Ğµ */
Â  Â  Â  width:46px;
Â  Â  Â  height:46px;
Â  Â  Â  border-radius:10px;
Â  Â  Â  background: rgba(255,255,255,.08);
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  box-shadow: 0 6px 18px rgba(0,0,0,.25);
Â  Â  Â  transform: translateZ(0);
Â  Â  }
Â  Â  #player::before{
Â  Â  Â  content:"ğŸ¹";
Â  Â  Â  font-size:28px;
Â  Â  Â  transform: translateY(-1px);
Â  Â  }

Â  Â  /* ĞŸÑ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ */
Â  Â  .obstacle{
Â  Â  Â  position:absolute;
Â  Â  Â  bottom:74px;
Â  Â  Â  width:26px;
Â  Â  Â  border-radius:8px;
Â  Â  Â  background: #64748b;
Â  Â  Â  box-shadow: 0 8px 18px rgba(0,0,0,.25);
Â  Â  Â  border:1px solid rgba(255,255,255,.12);
Â  Â  }
Â  Â  .obstacle.tall{ height:56px; }
Â  Â  .obstacle.small{ height:36px; }
Â  Â  .obstacle.pit{
Â  Â  Â  bottom:0;
Â  Â  Â  height:74px;
Â  Â  Â  width:76px;
Â  Â  Â  background: repeating-linear-gradient(
Â  Â  Â  Â  45deg,
Â  Â  Â  Â  #0b1220,
Â  Â  Â  Â  #0b1220 8px,
Â  Â  Â  Â  #111827 8px,
Â  Â  Â  Â  #111827 16px
Â  Â  Â  );
Â  Â  Â  border-top: 2px dashed rgba(255,255,255,.18);
Â  Â  Â  border-left: 1px solid rgba(255,255,255,.06);
Â  Â  Â  border-right: 1px solid rgba(255,255,255,.06);
Â  Â  Â  border-radius: 0;
Â  Â  Â  box-shadow:none;
Â  Â  }

Â  Â  #hint{
Â  Â  Â  color:var(--muted);
Â  Â  Â  font-size:13px;
Â  Â  Â  line-height:1.35;
Â  Â  }

Â  Â  /* Ğ­ĞºÑ€Ğ°Ğ½ Game Over */
Â  Â  #overlay{
Â  Â  Â  position:absolute;
Â  Â  Â  inset:0;
Â  Â  Â  background: rgba(0,0,0,.58);
Â  Â  Â  display:none;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  padding:16px;
Â  Â  }
Â  Â  #overlay .box{
Â  Â  Â  width:min(420px, 94vw);
Â  Â  Â  background: rgba(17,24,39,.92);
Â  Â  Â  border:1px solid rgba(255,255,255,.10);
Â  Â  Â  border-radius:14px;
Â  Â  Â  padding:14px;
Â  Â  Â  text-align:center;
Â  Â  Â  box-shadow: 0 20px 50px rgba(0,0,0,.45);
Â  Â  }
Â  Â  #overlay h2{ margin:6px 0 6px; }
Â  Â  #overlay p{ margin:6px 0; color:var(--muted); }
Â  Â  #overlay .big{
Â  Â  Â  font-size:18px;
Â  Â  Â  color:var(--text);
Â  Â  Â  font-weight:800;
Â  Â  Â  margin-top:10px;
Â  Â  }

Â  Â  /* Ğ’ÑĞ¿Ğ»Ñ‹Ğ²Ğ°ÑˆĞºĞ° Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹ */
Â  Â  #toast{
Â  Â  Â  position:absolute;
Â  Â  Â  top:14px;
Â  Â  Â  left:50%;
Â  Â  Â  transform:translateX(-50%);
Â  Â  Â  background: rgba(2,6,23,.85);
Â  Â  Â  border: 1px solid rgba(255,255,255,.10);
Â  Â  Â  padding:10px 12px;
Â  Â  Â  border-radius:12px;
Â  Â  Â  display:none;
Â  Â  Â  font-weight:800;
Â  Â  Â  box-shadow: 0 12px 30px rgba(0,0,0,.35);
Â  Â  }
Â  </style>
</head>

<body>
Â  <div id="app">
Â  Â  <div class="top">
Â  Â  Â  <div>
Â  Â  Â  Â  <h1>ğŸ¹ WG Archer Run</h1>
Â  Â  Â  Â  <div class="stats">
Â  Â  Â  Â  Â  <div>â± Ğ’Ñ€ĞµĞ¼Ñ: <b id="time">0.0</b> ÑĞµĞº</div>
Â  Â  Â  Â  Â  <div>ğŸ Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ: <b id="distance">0</b> Ğ¼</div>
Â  Â  Â  Â  Â  <div>âš¡ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: <b id="speed">1.0</b>x</div>
Â  Â  Â  Â  Â  <div>ğŸ† Ğ ĞµĞºĞ¾Ñ€Ğ´: <b id="best">0</b> Ğ¼</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <button id="playBtn">â–¶ Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ</button>
Â  Â  Â  Â  <button id="resetBtn" class="secondary">â†» Ğ¡Ğ±Ñ€Ğ¾Ñ</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="gameWrap">
Â  Â  Â  <div id="toast"></div>
Â  Â  Â  <div id="player"></div>
Â  Â  Â  <div id="ground"></div>

Â  Â  Â  <div id="overlay">
Â  Â  Â  Â  <div class="box">
Â  Â  Â  Â  Â  <h2>ğŸ’€ Ğ¢Ñ‹ Ğ¿Ñ€Ğ¾Ğ¸Ğ³Ñ€Ğ°Ğ»</h2>
Â  Â  Â  Â  Â  <p>ĞÑˆĞ¸Ğ±ÑÑ â€” ÑĞ¼ĞµÑ€Ñ‚ÑŒ, Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑˆÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾.</p>
Â  Â  Â  Â  Â  <div class="big">Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ: <span id="finalDist">0</span> Ğ¼</div>
Â  Â  Â  Â  Â  <div class="big">ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: <span id="finalReward">0</span> Ğ¼Ğ¾Ğ½ĞµÑ‚</div>
Â  Â  Â  Â  Â  <div style="margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
Â  Â  Â  Â  Â  Â  <button id="againBtn">â–¶ Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ ĞµÑ‰Ñ‘</button>
Â  Â  Â  Â  Â  Â  <button id="closeBtn" class="secondary">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="hint">
Â  Â  Â  Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: Ğ¿Ñ€Ğ¾Ğ±ĞµĞ» / ĞºĞ»Ğ¸Ğº Ğ¼Ñ‹ÑˆÑŒÑ / Ñ‚Ğ°Ğ¿ Ğ¿Ğ¾ ÑĞºÑ€Ğ°Ğ½Ñƒ â€” Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº.<br/>
Â  Â  Â  ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹ ÑÑ‡Ğ¸Ñ‚Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸ (Ğ¼ĞµÑ‚Ñ€Ñ‹). ĞŸĞ¾Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ğ¼ Ğº Ğ±Ğ¾Ñ‚Ñƒ Ğ¸ Ğ±ÑƒĞ´ĞµĞ¼ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑÑ‚ÑŒ Ğ¼Ğ¾Ğ½ĞµÑ‚Ñ‹.
Â  Â  </div>
Â  </div>

<script>
Â  // Telegram (Ğ½Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾, Ğ½Ğ¾ Ğ¿ÑƒÑÑ‚ÑŒ Ğ±ÑƒĞ´ĞµÑ‚)
Â  try{
Â  Â  if(window.Telegram?.WebApp){
Â  Â  Â  Telegram.WebApp.ready();
Â  Â  Â  Telegram.WebApp.expand();
Â  Â  }
Â  }catch(e){}

Â  const game = document.getElementById("gameWrap");
Â  const player = document.getElementById("player");
Â  const timeEl = document.getElementById("time");
Â  const distEl = document.getElementById("distance");
Â  const speedEl = document.getElementById("speed");
Â  const bestEl = document.getElementById("best");

Â  const overlay = document.getElementById("overlay");
Â  const finalDist = document.getElementById("finalDist");
Â  const finalReward = document.getElementById("finalReward");

Â  const toast = document.getElementById("toast");

Â  const playBtn = document.getElementById("playBtn");
Â  const resetBtn = document.getElementById("resetBtn");
Â  const againBtn = document.getElementById("againBtn");
Â  const closeBtn = document.getElementById("closeBtn");

Â  // ==== ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ñ‹Ğ¶ĞºĞ° (Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ "Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸") ====
Â  let gravity = 0.55;
Â  let jumpPower = 12.5;

Â  let vy = 0;
Â  let y = 0; Â  Â  Â  Â  Â  Â // Ğ²Ñ‹ÑĞ¾Ñ‚Ğ° Ğ¿Ñ€Ñ‹Ğ¶ĞºĞ° (0 = Ğ½Ğ° Ğ·ĞµĞ¼Ğ»Ğµ)
Â  let onGround = true;

Â  // ==== Ğ˜Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ====
Â  let running = false;
Â  let startTime = 0;
Â  let lastFrame = 0;

Â  let distance = 0; Â  // Ğ¼ĞµÑ‚Ñ€Ñ‹
Â  let speed = 6; Â  Â  Â // ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹ (px/frame-ish)
Â  let speedMult = 1.0;

Â  let best = Number(localStorage.getItem("wg_best") || 0);
Â  bestEl.textContent = best;

Â  // ==== ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ¿Ğ¾ Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸ (ÑƒÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ†Ğ¸Ñ„Ñ€Ñ‹, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑĞµĞ¼) ====
Â  // Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: { m: Ğ¼ĞµÑ‚Ñ€Ñ‹, coins: Ğ¼Ğ¾Ğ½ĞµÑ‚Ñ‹ }
Â  const milestones = [
Â  Â  { m: 200, Â coins: 50 },
Â  Â  { m: 700, Â coins: 100 },
Â  Â  { m: 1500, coins: 300 },
Â  Â  { m: 3000, coins: 500 },
Â  Â  { m: 4500, coins: 2000 },
Â  Â  { m: 6000, coins: 5000 } // "Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ¸Ğ¶Ğ¸Ğ¼Ğ°Ñ"
Â  ];
Â  let nextMilestoneIndex = 0;
Â  let earnedCoins = 0;

Â  function showToast(text){
Â  Â  toast.textContent = text;
Â  Â  toast.style.display = "block";
Â  Â  clearTimeout(showToast._t);
Â  Â  showToast._t = setTimeout(()=> toast.style.display = "none", 1800);
Â  }

Â  // ==== ĞŸÑ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ ====
Â  const obstacles = [];

Â  // ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ: ĞĞĞ ĞœĞĞ›Ğ¬ĞĞ«Ğ• Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¾ "Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾"
Â  // Ğ“ÑĞ¿ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸: Ñ‡ĞµĞ¼ Ğ²Ñ‹ÑˆĞµ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ â€” Ñ‚ĞµĞ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ».
Â  function calcMinGapPx(){
Â  Â  // Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ + Ğ¿Ñ€Ğ¸Ğ±Ğ°Ğ²ĞºĞ° Ğ¾Ñ‚ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸
Â  Â  return 260 + (speedMult - 1) * 120; // Ñ‡ĞµĞ¼ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ, Ñ‚ĞµĞ¼ Ñ€ĞµĞ¶Ğµ
Â  }
Â  function calcMaxGapPx(){
Â  Â  return 520 + (speedMult - 1) * 180;
Â  }

Â  let nextSpawnX = 0;

Â  function spawnObstacle(){
Â  Â  const w = game.clientWidth;

Â  Â  // 20% ÑĞ¼Ğ°, 80% Ğ±Ğ»Ğ¾Ğº (Ğ¼Ğ°Ğ»Ñ‹Ğ¹/Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹)
Â  Â  const typeRoll = Math.random();

Â  Â  const el = document.createElement("div");

Â  Â  if(typeRoll < 0.20){
Â  Â  Â  el.className = "obstacle pit";
Â  Â  Â  el.dataset.type = "pit";
Â  Â  }else{
Â  Â  Â  const tall = Math.random() < 0.45; // 45% Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ñ…
Â  Â  Â  el.className = "obstacle " + (tall ? "tall" : "small");
Â  Â  Â  el.dataset.type = tall ? "tall" : "small";
Â  Â  }

Â  Â  // ÑÑ‚Ğ°Ğ²Ğ¸Ğ¼ ÑĞ¿Ñ€Ğ°Ğ²Ğ° Ğ·Ğ° ÑĞºÑ€Ğ°Ğ½Ğ¾Ğ¼
Â  Â  const startX = Math.max(w + 40, nextSpawnX);
Â  Â  el.style.left = startX + "px";

Â  Â  game.appendChild(el);
Â  Â  obstacles.push(el);

Â  Â  // ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑĞ¿Ğ°Ğ²Ğ½: Ğ²ÑĞµĞ³Ğ´Ğ° Ñ Ğ°Ğ´ĞµĞºĞ²Ğ°Ñ‚Ğ½Ñ‹Ğ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ğ¾Ğ¼
Â  Â  const minGap = calcMinGapPx();
Â  Â  const maxGap = calcMaxGapPx();
Â  Â  const gap = minGap + Math.random() * (maxGap - minGap);

Â  Â  nextSpawnX = startX + gap;

Â  Â  // ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ "Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°" Ğ¾Ñ‚ ÑĞµÑ€Ğ¸Ğ¹:
Â  Â  // ĞµÑĞ»Ğ¸ 2 Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´ Ğ±Ñ‹Ğ»Ğ¸ "pit", ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ½Ğµ pit
Â  Â  const last2 = obstacles.slice(-3).map(o => o.dataset.type);
Â  Â  if(last2.filter(t => t === "pit").length >= 2){
Â  Â  Â  // Ğ¿Ğ¾Ğ´Ğ²Ğ¸Ğ½ĞµĞ¼ Ğ´Ğ°Ğ»ÑŒÑˆĞµ Ğ¸ ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ¸Ğ¼ ÑˆĞ°Ğ½Ñ ÑĞ¼
Â  Â  Â  nextSpawnX += 120;
Â  Â  }
Â  }

Â  function clearObstacles(){
Â  Â  obstacles.forEach(o => o.remove());
Â  Â  obstacles.length = 0;
Â  Â  nextSpawnX = 0;
Â  }

Â  // ==== Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ====
Â  function jump(){
Â  Â  if(!running) return;
Â  Â  if(onGround){
Â  Â  Â  vy = jumpPower;
Â  Â  Â  onGround = false;
Â  Â  }
Â  }

Â  window.addEventListener("keydown", (e)=>{
Â  Â  if(e.code === "Space"){
Â  Â  Â  e.preventDefault();
Â  Â  Â  jump();
Â  Â  }
Â  });

Â  // Ñ‚Ğ°Ğ¿/ĞºĞ»Ğ¸Ğº Ğ¿Ğ¾ ÑĞ°Ğ¼Ğ¾Ğ¹ Ğ¸Ğ³Ñ€Ğµ
Â  game.addEventListener("pointerdown", (e)=>{
Â  Â  e.preventDefault();
Â  Â  jump();
Â  }, {passive:false});

Â  // ==== Ğ¡Ñ‚Ğ°Ñ€Ñ‚ / Ğ¡Ñ‚Ğ¾Ğ¿ ====
Â  function startGame(){
Â  Â  overlay.style.display = "none";
Â  Â  running = true;
Â  Â  startTime = performance.now();
Â  Â  lastFrame = startTime;
Â  Â  distance = 0;
Â  Â  speedMult = 1.0;
Â  Â  earnedCoins = 0;
Â  Â  nextMilestoneIndex = 0;

Â  Â  y = 0;
Â  Â  vy = 0;
Â  Â  onGround = true;
Â  Â  player.style.bottom = "74px";

Â  Â  clearObstacles();
Â  Â  // ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ Ñ‡ÑƒÑ‚ÑŒ Ğ¿Ğ¾Ğ·Ğ¶Ğµ
Â  Â  nextSpawnX = game.clientWidth + 320;

Â  Â  requestAnimationFrame(loop);
Â  }

Â  function gameOver(){
Â  Â  running = false;

Â  Â  // Ñ€ĞµĞºĞ¾Ñ€Ğ´
Â  Â  if(distance > best){
Â  Â  Â  best = Math.floor(distance);
Â  Â  Â  localStorage.setItem("wg_best", best);
Â  Â  Â  bestEl.textContent = best;
Â  Â  }

Â  Â  finalDist.textContent = Math.floor(distance);
Â  Â  finalReward.textContent = earnedCoins;

Â  Â  overlay.style.display = "flex";
Â  }

Â  function resetAll(){
Â  Â  running = false;
Â  Â  overlay.style.display = "none";
Â  Â  distance = 0;
Â  Â  earnedCoins = 0;
Â  Â  nextMilestoneIndex = 0;
Â  Â  timeEl.textContent = "0.0";
Â  Â  distEl.textContent = "0";
Â  Â  speedEl.textContent = "1.0";
Â  Â  clearObstacles();
Â  Â  y = 0;
Â  Â  vy = 0;
Â  Â  onGround = true;
Â  Â  player.style.bottom = "74px";
Â  }

Â  playBtn.addEventListener("click", startGame);
Â  againBtn.addEventListener("click", startGame);
Â  resetBtn.addEventListener("click", resetAll);
Â  closeBtn.addEventListener("click", ()=>{
Â  Â  // Ğ’ Telegram Ğ¼Ğ¸Ğ½Ğ¸-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ
Â  Â  try{
Â  Â  Â  Telegram.WebApp.close();
Â  Â  }catch(e){
Â  Â  Â  overlay.style.display = "none";
Â  Â  }
Â  });

Â  // ==== ĞšĞ¾Ğ»Ğ»Ğ¸Ğ·Ğ¸Ğ¸ ====
Â  function rect(el){
Â  Â  return el.getBoundingClientRect();
Â  }

Â  function intersects(r1, r2){
Â  Â  return !(r2.left > r1.right ||
Â  Â  Â  Â  Â  Â  Â r2.right < r1.left ||
Â  Â  Â  Â  Â  Â  Â r2.top > r1.bottom ||
Â  Â  Â  Â  Â  Â  Â r2.bottom < r1.top);
Â  }

Â  function loop(ts){
Â  Â  if(!running) return;

Â  Â  const dt = (ts - lastFrame) / 16.67; // Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ 60fps
Â  Â  lastFrame = ts;

Â  Â  // Ğ²Ñ€ĞµĞ¼Ñ
Â  Â  const t = (ts - startTime) / 1000;
Â  Â  timeEl.textContent = t.toFixed(1);

Â  Â  // ÑƒÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ (Ğ¼ÑĞ³ĞºĞ¾Ğµ): ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ ~20 ÑĞµĞº Ñ‡ÑƒÑ‚ÑŒ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ
Â  Â  speedMult = 1.0 + Math.min(1.2, t / 20) * 0.25; // Ğ´Ğ¾ ~1.3x
Â  Â  speedEl.textContent = speedMult.toFixed(1);

Â  Â  // Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ (Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ğ° Ğº ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸)
Â  Â  distance += (0.9 * speedMult) * dt * 6; // "Ğ¼ĞµÑ‚Ñ€Ñ‹" ÑƒÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ, Ğ½Ğ¾ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ
Â  Â  distEl.textContent = Math.floor(distance);

Â  Â  // Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº Ñ„Ğ¸Ğ·Ğ¸ĞºĞ°
Â  Â  if(!onGround){
Â  Â  Â  y += vy * dt;
Â  Â  Â  vy -= gravity * dt;

Â  Â  Â  if(y <= 0){
Â  Â  Â  Â  y = 0;
Â  Â  Â  Â  vy = 0;
Â  Â  Â  Â  onGround = true;
Â  Â  Â  }
Â  Â  Â  player.style.bottom = (74 + y) + "px";
Â  Â  }

Â  Â  // ÑĞ¿Ğ°Ğ²Ğ½ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹
Â  Â  // ÑĞ¿Ğ°Ğ²Ğ½Ğ¸Ğ¼ ĞºĞ¾Ğ³Ğ´Ğ° ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ X ÑƒĞ¶Ğµ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğº Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ¼Ñƒ ĞºÑ€Ğ°Ñ
Â  Â  if(nextSpawnX <= game.clientWidth + 900){
Â  Â  Â  spawnObstacle();
Â  Â  }

Â  Â  // Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹
Â  Â  const pxPerFrame = (6.3 * speedMult) * dt;

Â  Â  for(let i = obstacles.length - 1; i >= 0; i--){
Â  Â  Â  const o = obstacles[i];
Â  Â  Â  const x = parseFloat(o.style.left);
Â  Â  Â  o.style.left = (x - pxPerFrame) + "px";

Â  Â  Â  // ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞµÑĞ»Ğ¸ ÑƒÑˆĞ»Ğ¾ Ğ²Ğ»ĞµĞ²Ğ¾
Â  Â  Â  if(x < -120){
Â  Â  Â  Â  o.remove();
Â  Â  Â  Â  obstacles.splice(i,1);
Â  Â  Â  Â  continue;
Â  Â  Â  }
Â  Â  }

Â  Â  // Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ¿Ğ¾ Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼
Â  Â  if(nextMilestoneIndex < milestones.length){
Â  Â  Â  const m = milestones[nextMilestoneIndex];
Â  Â  Â  if(distance >= m.m){
Â  Â  Â  Â  earnedCoins += m.coins;
Â  Â  Â  Â  showToast(`âœ… ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: +${m.coins} Ğ¼Ğ¾Ğ½ĞµÑ‚ (Ğ·Ğ° ${m.m} Ğ¼)`);
Â  Â  Â  Â  nextMilestoneIndex++;
Â  Â  Â  }
Â  Â  }

Â  Â  // ĞºĞ¾Ğ»Ğ»Ğ¸Ğ·Ğ¸Ğ¸
Â  Â  const pr = rect(player);

Â  Â  for(const o of obstacles){
Â  Â  Â  const or = rect(o);

Â  Â  Â  if(intersects(pr, or)){
Â  Â  Â  Â  // Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´Ğ»Ñ ÑĞ¼Ñ‹: ĞµÑĞ»Ğ¸ Ğ¸Ğ³Ñ€Ğ¾Ğº Ğ½Ğ° Ğ·ĞµĞ¼Ğ»Ğµ Ğ¸ Ğ¿Ğ¾Ğ¿Ğ°Ğ» Ğ² ÑĞ¼Ñƒ â€” ÑĞ¼ĞµÑ€Ñ‚ÑŒ
Â  Â  Â  Â  if(o.dataset.type === "pit"){
Â  Â  Â  Â  Â  if(onGround && y <= 2){
Â  Â  Â  Â  Â  Â  gameOver();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }else{
Â  Â  Â  Â  Â  // Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº
Â  Â  Â  Â  Â  gameOver();
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  requestAnimationFrame(loop);
Â  }

Â  // Ğ˜Ğ·Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾ â€” Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ ÑÑ‚Ğ°Ñ€Ñ‚
Â  resetAll();
</script>
</body>
</html>
