<!doctype html>
<html lang="ru">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
Â  <title>WG Archer Run</title>
Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â  <style>
Â  Â  html, body {
Â  Â  Â  margin: 0; padding: 0; height: 100%;
Â  Â  Â  background: #06152a;
Â  Â  Â  overflow: hidden;
Â  Â  Â  font-family: system-ui, -apple-system, Arial;
Â  Â  Â  color: #fff;
Â  Â  Â  -webkit-user-select: none; user-select: none;
Â  Â  Â  -webkit-tap-highlight-color: transparent;
Â  Â  }

Â  Â  #wrap{
Â  Â  Â  position: fixed;
Â  Â  Â  inset: 0;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  }

Â  Â  /* Ğ’ĞµÑ€Ñ…Ğ½ÑÑ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ ÑĞ¾ ÑÑ‚Ğ°Ñ‚Ğ°Ğ¼Ğ¸ */
Â  Â  #hud{
Â  Â  Â  padding: 10px 14px;
Â  Â  Â  display: flex;
Â  Â  Â  gap: 14px;
Â  Â  Â  align-items: center;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  background: rgba(0,0,0,0.12);
Â  Â  Â  backdrop-filter: blur(6px);
Â  Â  }
Â  Â  .chip{
Â  Â  Â  display: inline-flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 8px;
Â  Â  Â  padding: 7px 10px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  background: rgba(255,255,255,0.08);
Â  Â  Â  font-weight: 700;
Â  Â  Â  letter-spacing: .2px;
Â  Â  }
Â  Â  .muted{ opacity:.85; font-weight: 600; }

Â  Â  /* Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ Ğ·Ğ¾Ğ½Ğ° = Ğ²ĞµÑÑŒ Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸Ğ¹ÑÑ ÑĞºÑ€Ğ°Ğ½ */
Â  Â  #gameBox{
Â  Â  Â  position: relative;
Â  Â  Â  flex: 1;
Â  Â  Â  min-height: 0;
Â  Â  }

Â  Â  canvas{
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  display:block;
Â  Â  Â  background: linear-gradient(#0b2240, #06152a);
Â  Â  }

Â  Â  /* ĞĞ²ĞµÑ€Ğ»ĞµĞ¸ */
Â  Â  #centerOverlay{
Â  Â  Â  position:absolute;
Â  Â  Â  inset:0;
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  pointer-events:none;
Â  Â  }

Â  Â  .panel{
Â  Â  Â  pointer-events:auto;
Â  Â  Â  width: min(92vw, 520px);
Â  Â  Â  border-radius: 18px;
Â  Â  Â  padding: 16px 16px 14px;
Â  Â  Â  background: rgba(0,0,0,0.55);
Â  Â  Â  border: 1px solid rgba(255,255,255,0.12);
Â  Â  Â  backdrop-filter: blur(8px);
Â  Â  Â  text-align:center;
Â  Â  }

Â  Â  .title{
Â  Â  Â  font-size: 28px;
Â  Â  Â  font-weight: 900;
Â  Â  Â  letter-spacing: .8px;
Â  Â  Â  margin: 2px 0 10px;
Â  Â  }
Â  Â  .sub{
Â  Â  Â  opacity:.9;
Â  Â  Â  margin: 0 0 12px;
Â  Â  }

Â  Â  .btnRow{
Â  Â  Â  display:flex;
Â  Â  Â  gap: 10px;
Â  Â  Â  justify-content:center;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  margin-top: 10px;
Â  Â  }
Â  Â  button{
Â  Â  Â  border:0;
Â  Â  Â  border-radius: 14px;
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: 800;
Â  Â  Â  background: #6aa5ff;
Â  Â  Â  color: #06152a;
Â  Â  Â  cursor:pointer;
Â  Â  }
Â  Â  button.secondary{
Â  Â  Â  background: rgba(255,255,255,0.14);
Â  Â  Â  color:#fff;
Â  Â  }

Â  Â  #toast{
Â  Â  Â  position:absolute;
Â  Â  Â  left: 12px;
Â  Â  Â  right: 12px;
Â  Â  Â  bottom: 12px;
Â  Â  Â  display:flex;
Â  Â  Â  justify-content:center;
Â  Â  Â  pointer-events:none;
Â  Â  }
Â  Â  #toast > div{
Â  Â  Â  pointer-events:none;
Â  Â  Â  max-width: 92vw;
Â  Â  Â  padding: 10px 12px;
Â  Â  Â  border-radius: 14px;
Â  Â  Â  background: rgba(0,0,0,0.55);
Â  Â  Â  border: 1px solid rgba(255,255,255,0.12);
Â  Â  Â  backdrop-filter: blur(8px);
Â  Â  Â  font-weight: 800;
Â  Â  Â  opacity:0;
Â  Â  Â  transform: translateY(8px);
Â  Â  Â  transition: .25s ease;
Â  Â  }
Â  Â  #toast > div.show{
Â  Â  Â  opacity:1;
Â  Â  Â  transform: translateY(0);
Â  Â  }

Â  Â  /* Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ° */
Â  Â  #lb{
Â  Â  Â  margin-top: 10px;
Â  Â  Â  text-align:left;
Â  Â  Â  opacity:.95;
Â  Â  }
Â  Â  #lb h4{ margin: 10px 0 6px; }
Â  Â  #lb ol{ margin: 0; padding-left: 18px; }
Â  Â  #lb li{ padding: 3px 0; }
Â  </style>
</head>
<body>
<div id="wrap">
Â  <div id="hud">
Â  Â  <div class="chip">ğŸ <span class="muted">Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ:</span> <span id="dist">0</span> Ğ¼</div>
Â  Â  <div class="chip">ğŸ† <span class="muted">Ğ ĞµĞºĞ¾Ñ€Ğ´:</span> <span id="best">0</span> Ğ¼</div>
Â  Â  <div class="chip">ğŸª™ <span class="muted">ĞœĞ¾Ğ½ĞµÑ‚Ñ‹:</span> <span id="coins">0</span></div>
Â  </div>

Â  <div id="gameBox">
Â  Â  <canvas id="c"></canvas>

Â  Â  <div id="centerOverlay">
Â  Â  Â  <div class="panel" id="startPanel">
Â  Â  Â  Â  <div class="title">WG Archer Run</div>
Â  Â  Â  Â  <p class="sub">Ğ¢Ğ°Ğ¿ Ğ¿Ğ¾ ÑĞºÑ€Ğ°Ğ½Ñƒ â€” Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº. Ğ¦ĞµĞ»ÑŒ: Ğ½Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ².</p>
Â  Â  Â  Â  <div class="btnRow">
Â  Â  Â  Â  Â  <button id="btnPlay">Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  <button class="secondary" id="btnReset">Ğ¡Ğ±Ñ€Ğ¾Ñ</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="lb"></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="panel" id="gameOverPanel" style="display:none;">
Â  Â  Â  Â  <div class="title">GAME OVER</div>
Â  Â  Â  Â  <p class="sub">Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ: <b><span id="finalDist">0</span> Ğ¼</b> Â· ĞœĞ¾Ğ½ĞµÑ‚Ñ‹: <b>+<span id="finalCoins">0</span></b></p>
Â  Â  Â  Â  <div class="btnRow">
Â  Â  Â  Â  Â  <button id="btnAgain">Ğ•Ñ‰Ñ‘ Ñ€Ğ°Ğ·</button>
Â  Â  Â  Â  Â  <button class="secondary" id="btnBack">ĞĞ°Ğ·Ğ°Ğ´</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="lb2"></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="toast"><div id="toastBox"></div></div>
Â  </div>
</div>

<script>
/* Telegram full screen */
try {
Â  Telegram.WebApp.ready();
Â  Telegram.WebApp.expand();
Â  Telegram.WebApp.disableVerticalSwipes?.();
} catch(e) {}

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const distEl = document.getElementById("dist");
const bestEl = document.getElementById("best");
const coinsEl = document.getElementById("coins");

const startPanel = document.getElementById("startPanel");
const gameOverPanel = document.getElementById("gameOverPanel");

const btnPlay = document.getElementById("btnPlay");
const btnReset = document.getElementById("btnReset");
const btnAgain = document.getElementById("btnAgain");
const btnBack = document.getElementById("btnBack");

const finalDistEl = document.getElementById("finalDist");
const finalCoinsEl = document.getElementById("finalCoins");

const toastBox = document.getElementById("toastBox");

function showToast(text){
Â  toastBox.textContent = text;
Â  toastBox.classList.add("show");
Â  clearTimeout(showToast._t);
Â  showToast._t = setTimeout(()=>toastBox.classList.remove("show"), 1400);
}

function resize(){
Â  const box = document.getElementById("gameBox");
Â  canvas.width = box.clientWidth;
Â  canvas.height = box.clientHeight;
}
window.addEventListener("resize", resize);
resize();

/* ====== ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ====== */
const GROUND_H = 110; Â  Â  Â  Â  Â  Â  Â  Â  Â // Ğ²Ñ‹ÑĞ¾Ñ‚Ğ° Ğ·ĞµĞ¼Ğ»Ğ¸
const PLAYER_H = 90; Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ğ²Ñ‹ÑĞ¾Ñ‚Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ
const PLAYER_W = 90; Â  Â  Â  Â  Â  Â  Â  Â  Â  // ÑˆĞ¸Ñ€Ğ¸Ğ½Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°
const GRAVITY = 2600; Â  Â  Â  Â  Â  Â  Â  Â  Â // Ğ¿Ğ¸ĞºÑ/Ñ^2
const JUMP_V = 980; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â // Ğ¿Ğ¸ĞºÑ/Ñ (Ğ²Ğ²ĞµÑ€Ñ…)
let SPEED = 460; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ğ¿Ğ¸ĞºÑ/Ñ (ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¸Ñ€Ğ°)
let speedMul = 1.0;

const OBST_W = 52;
const OBST_MIN_H = 60;
const OBST_MAX_H = 120;

/* ====== Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ====== */
let state = "menu"; // menu | play | over
let distance = 0;
let coins = 0;
let earnedThisRun = 0;

let best = Number(localStorage.getItem("wg_best_m") || 0);
bestEl.textContent = best;

let lb = JSON.parse(localStorage.getItem("wg_lb") || "[]"); // Ğ¼Ğ°ÑÑĞ¸Ğ² Ğ»ÑƒÑ‡ÑˆĞ¸Ñ… Ğ·Ğ°Ğ±ĞµĞ³Ğ¾Ğ²
renderLeaderboard();

/* ====== Ğ¡Ğ¿Ñ€Ğ°Ğ¹Ñ‚ ====== */
const sprite = new Image();
sprite.src = "archer.png"; Â // Ñ„Ğ°Ğ¹Ğ» Ñƒ Ñ‚ĞµĞ±Ñ Ğ² ĞºĞ¾Ñ€Ğ½Ğµ Ñ€ĞµĞ¿Ñ‹

let spriteReady = false;
let frameW = 0, frameH = 0;
sprite.onload = () => {
Â  spriteReady = true;
Â  frameW = Math.floor(sprite.width / 3); Â  Â // 3 ĞºĞ°Ğ´Ñ€Ğ° Ğ¿Ğ¾ ÑˆĞ¸Ñ€Ğ¸Ğ½Ğµ
Â  frameH = Math.floor(sprite.height / 3); Â  // 3 Ñ€ÑĞ´Ğ° Ğ¿Ğ¾ Ğ²Ñ‹ÑĞ¾Ñ‚Ğµ (Ğ²ĞµÑ€Ñ…/ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ°/Ğ½Ğ¸Ğ·)
};

function drawSprite(row, col, x, y, w, h){
Â  if(!spriteReady){
Â  Â  // fallback: ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ğ»Ğ¾ÑÑŒ â€” Ñ€Ğ¸ÑÑƒĞµĞ¼ ÑĞ¸Ğ»ÑƒÑÑ‚
Â  Â  ctx.fillStyle = "#e6f0ff";
Â  Â  ctx.fillRect(x, y, w, h);
Â  Â  return;
Â  }
Â  const sx = col * frameW;
Â  const sy = row * frameH;
Â  ctx.drawImage(sprite, sx, sy, frameW, frameH, x, y, w, h);
}

/* ====== Ğ˜Ğ³Ñ€Ğ¾Ğº (Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹ ÑĞ²ĞµÑ€Ñ…Ñƒ-Ğ²Ğ½Ğ¸Ğ·) ====== */
const player = {
Â  x: 90,
Â  y: 0,
Â  vy: 0,
Â  w: PLAYER_W,
Â  h: PLAYER_H,
Â  onGround: true,
Â  animT: 0
};

function groundY(){
Â  return canvas.height - GROUND_H;
}

function resetRun(){
Â  distance = 0;
Â  earnedThisRun = 0;
Â  coins = Number(localStorage.getItem("wg_coins") || 0);
Â  coinsEl.textContent = coins;

Â  SPEED = 460;
Â  speedMul = 1.0;

Â  player.y = groundY() - player.h;
Â  player.vy = 0;
Â  player.onGround = true;
Â  player.animT = 0;

Â  obstacles.length = 0;
Â  nextSpawnX = canvas.width + 300;

Â  distEl.textContent = "0";
}

btnReset.onclick = () => {
Â  localStorage.removeItem("wg_best_m");
Â  localStorage.removeItem("wg_lb");
Â  localStorage.removeItem("wg_coins");
Â  best = 0;
Â  lb = [];
Â  bestEl.textContent = "0";
Â  coinsEl.textContent = "0";
Â  renderLeaderboard();
Â  showToast("Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½");
};

btnPlay.onclick = () => startGame();
btnAgain.onclick = () => startGame();
btnBack.onclick = () => {
Â  state = "menu";
Â  gameOverPanel.style.display = "none";
Â  startPanel.style.display = "block";
Â  renderLeaderboard();
};

function startGame(){
Â  state = "play";
Â  startPanel.style.display = "none";
Â  gameOverPanel.style.display = "none";
Â  resetRun();
}

/* ====== ĞŸÑ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ (Ñ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¾ĞºĞ½Ğ°Ğ¼Ğ¸) ====== */
const obstacles = [];
let nextSpawnX = canvas.width + 300;

function spawnObstacle(){
Â  const h = randInt(OBST_MIN_H, OBST_MAX_H);
Â  obstacles.push({
Â  Â  x: nextSpawnX,
Â  Â  y: groundY() - h,
Â  Â  w: OBST_W,
Â  Â  h
Â  });

Â  // Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ğº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ±Ñ‹Ğ»Ğ¾ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ¿Ñ€Ñ‹Ğ³Ğ½ÑƒÑ‚ÑŒ:
Â  // Ñ‡ĞµĞ¼ Ğ²Ñ‹ÑˆĞµ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ â€” Ñ‚ĞµĞ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ.
Â  const minGap = 280 + SPEED * 0.35; Â  Â  Â  Â  Â // Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ·Ğ¾Ñ€
Â  const extra = randInt(0, 180); Â  Â  Â  Â  Â  Â  Â // ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾ÑÑ‚ÑŒ
Â  nextSpawnX += minGap + extra;
}

function randInt(a,b){ return Math.floor(a + Math.random()*(b-a+1)); }

/* ====== ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹ ====== */
const rewardSteps = [
Â  { m: 200, coins: 50 },
Â  { m: 500, coins: 120 },
Â  { m: 1000, coins: 300 },
Â  { m: 2000, coins: 700 }
];
let rewardGiven = new Set();

function checkRewards(){
Â  for(const r of rewardSteps){
Â  Â  if(distance >= r.m && !rewardGiven.has(r.m)){
Â  Â  Â  rewardGiven.add(r.m);
Â  Â  Â  coins += r.coins;
Â  Â  Â  earnedThisRun += r.coins;
Â  Â  Â  localStorage.setItem("wg_coins", String(coins));
Â  Â  Â  coinsEl.textContent = coins;
Â  Â  Â  showToast(`âœ… ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: +${r.coins} Ğ¼Ğ¾Ğ½ĞµÑ‚ (Ğ·Ğ° ${r.m} Ğ¼)`);
Â  Â  }
Â  }
}

/* ====== Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ‚Ğ°Ğ¿/ĞºĞ»Ğ¸Ğº ====== */
function doJump(){
Â  if(state !== "play") return;
Â  if(player.onGround){
Â  Â  player.vy = -JUMP_V;
Â  Â  player.onGround = false;
Â  }
}

canvas.addEventListener("touchstart", (e)=>{ e.preventDefault(); doJump(); }, {passive:false});
canvas.addEventListener("click", ()=> doJump()); // Ğ½Ğ° ĞŸĞš ÑƒĞ´Ğ¾Ğ±Ğ½Ğ¾

/* ====== Game Over ====== */
function endGame(){
Â  state = "over";

Â  // Ñ€ĞµĞºĞ¾Ñ€Ğ´
Â  const m = Math.floor(distance);
Â  if(m > best){
Â  Â  best = m;
Â  Â  localStorage.setItem("wg_best_m", String(best));
Â  }
Â  bestEl.textContent = best;

Â  // Ğ»Ğ¸Ğ´ĞµÑ€Ğ±Ğ¾Ñ€Ğ´
Â  lb.push({ m, ts: Date.now() });
Â  lb.sort((a,b)=>b.m-a.m);
Â  lb = lb.slice(0, 5);
Â  localStorage.setItem("wg_lb", JSON.stringify(lb));

Â  finalDistEl.textContent = m;
Â  finalCoinsEl.textContent = earnedThisRun;

Â  startPanel.style.display = "none";
Â  gameOverPanel.style.display = "block";
Â  renderLeaderboard(true);
}

/* ====== Ğ ĞµĞ½Ğ´ĞµÑ€ Ğ»Ğ¸Ğ´ĞµÑ€Ğ±Ğ¾Ñ€Ğ´Ğ° ====== */
function renderLeaderboard(isGameOver=false){
Â  const el = document.getElementById(isGameOver ? "lb2" : "lb");
Â  if(!el) return;

Â  if(lb.length === 0){
Â  Â  el.innerHTML = "<h4>Ğ¢Ğ¾Ğ¿</h4><div class='muted'>ĞŸĞ¾ĞºĞ° Ğ¿ÑƒÑÑ‚Ğ¾ â€” ÑÑ‹Ğ³Ñ€Ğ°Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·.</div>";
Â  Â  return;
Â  }
Â  const items = lb.map((x,i)=>`<li><b>#${i+1}</b> â€” ${x.m} Ğ¼</li>`).join("");
Â  el.innerHTML = `<h4>Ğ¢Ğ¾Ğ¿ 5</h4><ol>${items}</ol>`;
}

/* ====== Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» ====== */
let last = performance.now();

function loop(now){
Â  const dt = Math.min(0.032, (now - last) / 1000);
Â  last = now;

Â  // Ñ„Ğ¾Ğ½
Â  ctx.clearRect(0,0,canvas.width,canvas.height);

Â  // Ğ·ĞµĞ¼Ğ»Ñ
Â  ctx.fillStyle = "#1a2a40";
Â  ctx.fillRect(0, groundY(), canvas.width, GROUND_H);

Â  if(state === "play"){
Â  Â  // ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ñ‡ÑƒÑ‚ÑŒ Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚ ÑĞ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½ĞµĞ¼
Â  Â  speedMul = 1 + Math.min(0.8, distance / 2500);
Â  Â  const worldSpeed = SPEED * speedMul;

Â  Â  // Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ Ğ² Ğ¼ĞµÑ‚Ñ€Ğ°Ñ… (Ğ¿Ñ€Ğ¸Ğ²ÑĞ¶ĞµĞ¼ Ğº ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸)
Â  Â  distance += (worldSpeed * dt) / 6.5;
Â  Â  distEl.textContent = String(Math.floor(distance));

Â  Â  // ÑĞ¿Ğ°Ğ²Ğ½ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ğ¹
Â  Â  if(obstacles.length === 0 && nextSpawnX < canvas.width) nextSpawnX = canvas.width + 300;
Â  Â  while(nextSpawnX < canvas.width + 900){
Â  Â  Â  spawnObstacle();
Â  Â  Â  if(obstacles.length > 6) break;
Â  Â  }

Â  Â  // Ğ¸Ğ³Ñ€Ğ¾Ğº Ñ„Ğ¸Ğ·Ğ¸ĞºĞ°
Â  Â  player.vy += GRAVITY * dt;
Â  Â  player.y += player.vy * dt;

Â  Â  const gy = groundY() - player.h;
Â  Â  if(player.y >= gy){
Â  Â  Â  player.y = gy;
Â  Â  Â  player.vy = 0;
Â  Â  Â  player.onGround = true;
Â  Â  }

Â  Â  // Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ
Â  Â  for(let i=obstacles.length-1; i>=0; i--){
Â  Â  Â  const o = obstacles[i];
Â  Â  Â  o.x -= worldSpeed * dt;
Â  Â  Â  if(o.x + o.w < -80) obstacles.splice(i,1);
Â  Â  }

Â  Â  // ĞºĞ¾Ğ»Ğ»Ğ¸Ğ·Ğ¸Ğ¸ (hitbox Ñ‡ÑƒÑ‚ÑŒ Ğ¼ĞµĞ½ÑŒÑˆĞµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ±Ñ‹Ğ»Ğ¾ â€œÑ‡ĞµÑÑ‚Ğ½ĞµĞµâ€)
Â  Â  const px1 = player.x + 12;
Â  Â  const py1 = player.y + 8;
Â  Â  const px2 = player.x + player.w - 12;
Â  Â  const py2 = player.y + player.h - 4;

Â  Â  for(const o of obstacles){
Â  Â  Â  const ox1 = o.x + 6;
Â  Â  Â  const oy1 = o.y + 2;
Â  Â  Â  const ox2 = o.x + o.w - 6;
Â  Â  Â  const oy2 = o.y + o.h;

Â  Â  Â  const hit = !(px2 < ox1 || px1 > ox2 || py2 < oy1 || py1 > oy2);
Â  Â  Â  if(hit){
Â  Â  Â  Â  endGame();
Â  Â  Â  Â  break;
Â  Â  Â  }
Â  Â  }

Â  Â  checkRewards();
Â  }

Â  // Ñ€Ğ¸ÑÑƒĞµĞ¼ Ğ¿Ñ€ĞµĞ¿ÑÑ‚ÑÑ‚Ğ²Ğ¸Ñ
Â  ctx.fillStyle = "#e54444";
Â  for(const o of obstacles){
Â  Â  ctx.fillRect(o.x, o.y, o.w, o.h);
Â  }

Â  // Ñ€Ğ¸ÑÑƒĞµĞ¼ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° ĞºĞ°Ğº Ğ¡ĞŸĞ ĞĞ™Ğ¢ (Ğ±ĞµĞ· ĞºĞ²Ğ°Ğ´Ñ€Ğ°Ñ‚Ğ°)
Â  // row: 0=Ğ±ĞµĞ³ (Ğ²ĞµÑ€Ñ…), 1=Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº/ÑÑ‚Ğ°Ñ€Ñ‚ (ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ°), 2=ÑĞ¼ĞµÑ€Ñ‚ÑŒ (Ğ½Ğ¸Ğ·)
Â  let row = 0;
Â  let col = 0;

Â  if(state === "over"){
Â  Â  row = 2; col = 0; // ÑĞ¼ĞµÑ€Ñ‚ÑŒ
Â  } else if(!player.onGround){
Â  Â  row = 1; col = 0; // Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº â€” Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ°Ğ´Ñ€ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ñ€ÑĞ´Ğ°
Â  } else {
Â  Â  // Ğ±ĞµĞ³ â€” 3 ĞºĞ°Ğ´Ñ€Ğ° Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ³Ğ¾ Ñ€ÑĞ´Ğ°
Â  Â  player.animT += dt;
Â  Â  col = Math.floor((player.animT * 10) % 3); // 10 fps
Â  Â  row = 0;
Â  }

Â  drawSprite(row, col, player.x, player.y, player.w, player.h);

Â  requestAnimationFrame(loop);
}

resetRun();
requestAnimationFrame(loop);
</script>
</body>
</html>
