<!doctype html>
<html lang="ru">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
Â  <title>WG Archer Run</title>
Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â  <style>
Â  Â  html, body { margin:0; padding:0; height:100%; background:#071a33; overflow:hidden; font-family: system-ui, -apple-system, Arial; }
Â  Â  #root{ position:fixed; inset:0; background: linear-gradient(#0b2548,#071a33); }
Â  Â  canvas{ position:absolute; inset:0; width:100%; height:100%; display:block; }

Â  Â  /* HUD */
Â  Â  #hud{
Â  Â  Â  position:absolute; left:12px; top:12px; right:12px;
Â  Â  Â  display:flex; gap:10px; flex-wrap:wrap;
Â  Â  Â  z-index:5;
Â  Â  Â  pointer-events:none;
Â  Â  }
Â  Â  .chip{
Â  Â  Â  display:inline-flex; gap:8px; align-items:center;
Â  Â  Â  padding:8px 10px; border-radius:14px;
Â  Â  Â  background: rgba(0,0,0,.35);
Â  Â  Â  color:#fff; font-weight:800;
Â  Â  Â  border: 1px solid rgba(255,255,255,.10);
Â  Â  Â  backdrop-filter: blur(8px);
Â  Â  }
Â  Â  .muted{ opacity:.85; font-weight:700; }

Â  Â  /* Overlay */
Â  Â  #overlay{
Â  Â  Â  position:absolute; inset:0;
Â  Â  Â  display:flex; align-items:center; justify-content:center;
Â  Â  Â  z-index:10;
Â  Â  Â  pointer-events:none;
Â  Â  }
Â  Â  .panel{
Â  Â  Â  pointer-events:auto;
Â  Â  Â  width:min(92vw,520px);
Â  Â  Â  border-radius:18px;
Â  Â  Â  padding:16px;
Â  Â  Â  background: rgba(0,0,0,.55);
Â  Â  Â  border:1px solid rgba(255,255,255,.12);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  color:#fff;
Â  Â  Â  text-align:center;
Â  Â  }
Â  Â  .title{ font-size:28px; font-weight:900; letter-spacing:.6px; margin:0 0 8px; }
Â  Â  .sub{ margin:0 0 12px; opacity:.9; font-weight:700; }
Â  Â  .btnRow{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
Â  Â  button{
Â  Â  Â  border:0; border-radius:14px; padding:12px 16px;
Â  Â  Â  font-size:16px; font-weight:900;
Â  Â  Â  background:#6aa5ff; color:#071a33; cursor:pointer;
Â  Â  }
Â  Â  button.secondary{ background: rgba(255,255,255,.14); color:#fff; }

Â  Â  #lb{ text-align:left; margin-top:10px; }
Â  Â  #lb h4{ margin:10px 0 6px; }
Â  Â  #lb ol{ margin:0; padding-left:18px; }
Â  Â  #lb li{ padding:3px 0; }

Â  Â  /* Toast */
Â  Â  #toast{
Â  Â  Â  position:absolute; left:12px; right:12px; bottom:12px;
Â  Â  Â  display:flex; justify-content:center;
Â  Â  Â  z-index:20; pointer-events:none;
Â  Â  }
Â  Â  #toastBox{
Â  Â  Â  opacity:0; transform: translateY(8px);
Â  Â  Â  transition:.22s ease;
Â  Â  Â  max-width:92vw;
Â  Â  Â  padding:10px 12px;
Â  Â  Â  border-radius:14px;
Â  Â  Â  background: rgba(0,0,0,.55);
Â  Â  Â  border:1px solid rgba(255,255,255,.12);
Â  Â  Â  backdrop-filter: blur(10px);
Â  Â  Â  color:#fff; font-weight:900;
Â  Â  }
Â  Â  #toastBox.show{ opacity:1; transform: translateY(0); }
Â  </style>
</head>

<body>
<div id="root">
Â  <canvas id="c"></canvas>

Â  <div id="hud">
Â  Â  <div class="chip">ğŸ <span class="muted">Ğ”Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ:</span> <span id="dist">0</span> Ğ¼</div>
Â  Â  <div class="chip">ğŸ† <span class="muted">Ğ ĞµĞºĞ¾Ñ€Ğ´:</span> <span id="best">0</span> Ğ¼</div>
Â  Â  <div class="chip">ğŸª™ <span class="muted">ĞœĞ¾Ğ½ĞµÑ‚Ñ‹:</span> <span id="coins">0</span></div>
Â  </div>

Â  <div id="overlay">
Â  Â  <div class="panel" id="menuPanel">
Â  Â  Â  <div class="title">WG Archer Run</div>
Â  Â  Â  <p class="sub">Ğ¢Ğ°Ğ¿ Ğ¿Ğ¾ ÑĞºÑ€Ğ°Ğ½Ñƒ â€” Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº. ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ñ‚Ğ°Ğ¿ â€” ÑÑ‚Ğ°Ñ€Ñ‚.</p>
Â  Â  Â  <div class="btnRow">
Â  Â  Â  Â  <button id="btnStart">Ğ˜Ğ³Ñ€Ğ°Ñ‚ÑŒ</button>
Â  Â  Â  Â  <button class="secondary" id="btnClear">Ğ¡Ğ±Ñ€Ğ¾Ñ</button>
Â  Â  Â  </div>
Â  Â  Â  <div id="lb"></div>
Â  Â  </div>

Â  Â  <div class="panel" id="overPanel" style="display:none;">
Â  Â  Â  <div class="title">GAME OVER</div>
Â  Â  Â  <p class="sub">Ğ—Ğ°Ğ±ĞµĞ³: <b><span id="finalDist">0</span> Ğ¼</b> Â· ĞœĞ¾Ğ½ĞµÑ‚Ñ‹: <b>+<span id="finalCoins">0</span></b></p>
Â  Â  Â  <div class="btnRow">
Â  Â  Â  Â  <button id="btnAgain">Ğ•Ñ‰Ñ‘ Ñ€Ğ°Ğ·</button>
Â  Â  Â  Â  <button class="secondary" id="btnBack">ĞœĞµĞ½Ñ</button>
Â  Â  Â  </div>
Â  Â  Â  <div id="lb2"></div>
Â  Â  </div>
Â  </div>

Â  <div id="toast"><div id="toastBox"></div></div>
</div>

<script>
/* Telegram */
try{
Â  Telegram.WebApp.ready();
Â  Telegram.WebApp.expand();
Â  Telegram.WebApp.disableVerticalSwipes?.();
} catch(e){}

/* UI refs */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d", { alpha: true });

const distEl = document.getElementById("dist");
const bestEl = document.getElementById("best");
const coinsEl = document.getElementById("coins");

const menuPanel = document.getElementById("menuPanel");
const overPanel = document.getElementById("overPanel");

const btnStart = document.getElementById("btnStart");
const btnAgain = document.getElementById("btnAgain");
const btnBack Â = document.getElementById("btnBack");
const btnClear = document.getElementById("btnClear");

const finalDistEl = document.getElementById("finalDist");
const finalCoinsEl = document.getElementById("finalCoins");

const toastBox = document.getElementById("toastBox");

function toast(t){
Â  toastBox.textContent = t;
Â  toastBox.classList.add("show");
Â  clearTimeout(toast._t);
Â  toast._t = setTimeout(()=>toastBox.classList.remove("show"), 1400);
}

/* Resize */
function resize(){
Â  canvas.width = window.innerWidth;
Â  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* Storage */
let best = Number(localStorage.getItem("wg_best_m") || 0);
let coins = Number(localStorage.getItem("wg_coins") || 0);
let lb = JSON.parse(localStorage.getItem("wg_lb10") || "[]"); // top10
bestEl.textContent = best;
coinsEl.textContent = coins;

/* Leaderboard render */
function renderLB(targetId){
Â  const el = document.getElementById(targetId);
Â  if(!el) return;
Â  if(lb.length === 0){
Â  Â  el.innerHTML = "<h4>Ğ¢Ğ¾Ğ¿-10</h4><div style='opacity:.85;font-weight:700;'>ĞŸĞ¾ĞºĞ° Ğ¿ÑƒÑÑ‚Ğ¾ â€” ÑÑ‹Ğ³Ñ€Ğ°Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·.</div>";
Â  Â  return;
Â  }
Â  const items = lb.map((x,i)=>`<li><b>#${i+1}</b> â€” ${x.m} Ğ¼</li>`).join("");
Â  el.innerHTML = `<h4>Ğ¢Ğ¾Ğ¿-10</h4><ol>${items}</ol>`;
}
renderLB("lb");

/* Game state */
let state = "menu"; // menu | play | over
let distance = 0;
let earnedThisRun = 0;

/* World constants */
const GROUND_H = 120;
const GRAVITY = 2700;
const JUMP_V Â = 980;

let BASE_SPEED = 520; // ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ğ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ¸Ñ€Ğ°
let speedMul = 1;

/* Player (hitbox) */
const player = {
Â  x: 90,
Â  y: 0,
Â  w: 84,
Â  h: 84,
Â  vy: 0,
Â  onGround: true,
Â  animT: 0
};

function groundY(){ return canvas.height - GROUND_H; }

/* Obstacles */
const obstacles = [];
let nextSpawnX = 0;

function randInt(a,b){ return Math.floor(a + Math.random()*(b-a+1)); }

function spawnObstacle(){
Â  const w = 54;
Â  const h = randInt(70, 135);
Â  obstacles.push({ x: nextSpawnX, y: groundY() - h, w, h });

Â  // Ğ“ĞĞŸ: Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ğ¹ (Ğ½ĞµÑ‚ â€œÑÑ‚ĞµĞ½Ñ‹â€)
Â  const worldSpeed = BASE_SPEED * speedMul;
Â  const minGap = 280 + worldSpeed * 0.35;
Â  nextSpawnX += minGap + randInt(0, 160);
}

/* Rewards */
const rewards = [
Â  { m: 200, coins: 50 },
Â  { m: 500, coins: 120 },
Â  { m: 1000, coins: 300 },
Â  { m: 2000, coins: 700 }
];
let rewardGiven = new Set();

/* Sprite */
const sprite = new Image();
sprite.src = "archer.png";
let spriteReady = false;
let frameW = 0, frameH = 0;

sprite.onload = () => {
Â  spriteReady = true;
Â  frameW = Math.floor(sprite.width / 3);
Â  frameH = Math.floor(sprite.height / 3);
};

function drawSprite(row, col, x, y, w, h){
Â  if(!spriteReady){
Â  Â  ctx.fillStyle = "#fff";
Â  Â  ctx.fillRect(x, y, w, h);
Â  Â  return;
Â  }
Â  const sx = col * frameW;
Â  const sy = row * frameH;
Â  ctx.drawImage(sprite, sx, sy, frameW, frameH, x, y, w, h);
}

/* Core */
function resetRun(){
Â  distance = 0;
Â  earnedThisRun = 0;
Â  rewardGiven = new Set();

Â  player.y = groundY() - player.h;
Â  player.vy = 0;
Â  player.onGround = true;
Â  player.animT = 0;

Â  obstacles.length = 0;
Â  nextSpawnX = canvas.width + 260;

Â  distEl.textContent = "0";
Â  coins = Number(localStorage.getItem("wg_coins") || 0);
Â  coinsEl.textContent = coins;

Â  BASE_SPEED = 520;
Â  speedMul = 1;
}

function startGame(){
Â  state = "play";
Â  menuPanel.style.display = "none";
Â  overPanel.style.display = "none";
Â  resetRun();
}

function endGame(){
Â  state = "over";

Â  const m = Math.floor(distance);
Â  if(m > best){
Â  Â  best = m;
Â  Â  localStorage.setItem("wg_best_m", String(best));
Â  }
Â  bestEl.textContent = best;

Â  lb.push({ m, ts: Date.now() });
Â  lb.sort((a,b)=>b.m-a.m);
Â  lb = lb.slice(0,10);
Â  localStorage.setItem("wg_lb10", JSON.stringify(lb));

Â  finalDistEl.textContent = m;
Â  finalCoinsEl.textContent = earnedThisRun;

Â  overPanel.style.display = "block";
Â  menuPanel.style.display = "none";
Â  renderLB("lb2");
}

/* Jump */
function jump(){
Â  if(state !== "play") return;
Â  if(player.onGround){
Â  Â  player.vy = -JUMP_V;
Â  Â  player.onGround = false;
Â  }
}

/* INPUT: Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ Ğ»Ğ¾Ğ²Ğ¸Ğ¼ Ğ½Ğ° Ğ¾ĞºĞ½Ğµ */
function onTap(e){
Â  // Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ iOS Ğ½Ğµ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ¸Ğ»/Ğ½Ğµ Ğ·ÑƒĞ¼Ğ¸Ğ»
Â  try{ e.preventDefault?.(); }catch(_){}
Â  if(state === "menu") { startGame(); return; }
Â  if(state === "over") { startGame(); return; }
Â  jump();
}
window.addEventListener("touchstart", onTap, { passive:false });
window.addEventListener("pointerdown", onTap, { passive:false });

/* Buttons */
btnStart.onclick = () => startGame();
btnAgain.onclick = () => startGame();
btnBack.onclick Â = () => { state="menu"; overPanel.style.display="none"; menuPanel.style.display="block"; renderLB("lb"); };
btnClear.onclick = () => {
Â  localStorage.removeItem("wg_best_m");
Â  localStorage.removeItem("wg_lb10");
Â  localStorage.removeItem("wg_coins");
Â  best = 0; coins = 0; lb = [];
Â  bestEl.textContent = "0";
Â  coinsEl.textContent = "0";
Â  renderLB("lb");
Â  toast("Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½");
};

/* Rewards check */
function checkRewards(){
Â  for(const r of rewards){
Â  Â  if(distance >= r.m && !rewardGiven.has(r.m)){
Â  Â  Â  rewardGiven.add(r.m);
Â  Â  Â  coins += r.coins;
Â  Â  Â  earnedThisRun += r.coins;
Â  Â  Â  localStorage.setItem("wg_coins", String(coins));
Â  Â  Â  coinsEl.textContent = coins;
Â  Â  Â  toast(`âœ… +${r.coins} Ğ¼Ğ¾Ğ½ĞµÑ‚ Ğ·Ğ° ${r.m} Ğ¼`);
Â  Â  }
Â  }
}

/* Loop */
let last = performance.now();

function loop(now){
Â  const dt = Math.min(0.033, (now - last)/1000);
Â  last = now;

Â  // background
Â  ctx.clearRect(0,0,canvas.width,canvas.height);

Â  // ground
Â  ctx.fillStyle = "rgba(20,45,75,0.95)";
Â  ctx.fillRect(0, groundY(), canvas.width, GROUND_H);

Â  if(state === "play"){
Â  Â  // speed progression
Â  Â  speedMul = 1 + Math.min(0.9, distance / 2600);
Â  Â  const worldSpeed = BASE_SPEED * speedMul;

Â  Â  // distance
Â  Â  distance += (worldSpeed * dt) / 6.8; // Ğ¼ĞµÑ‚Ñ€Ñ‹
Â  Â  distEl.textContent = String(Math.floor(distance));

Â  Â  // spawn obstacles
Â  Â  while(nextSpawnX < canvas.width + 900){
Â  Â  Â  spawnObstacle();
Â  Â  Â  if(obstacles.length > 7) break;
Â  Â  }

Â  Â  // player physics
Â  Â  player.vy += GRAVITY * dt;
Â  Â  player.y += player.vy * dt;

Â  Â  const gy = groundY() - player.h;
Â  Â  if(player.y >= gy){
Â  Â  Â  player.y = gy;
Â  Â  Â  player.vy = 0;
Â  Â  Â  player.onGround = true;
Â  Â  }

Â  Â  // move obstacles
Â  Â  for(let i = obstacles.length-1; i>=0; i--){
Â  Â  Â  obstacles[i].x -= worldSpeed * dt;
Â  Â  Â  if(obstacles[i].x + obstacles[i].w < -120) obstacles.splice(i,1);
Â  Â  }

Â  Â  // collisions (Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ forgiving)
Â  Â  const px1 = player.x + 10, px2 = player.x + player.w - 10;
Â  Â  const py1 = player.y + 6, Â py2 = player.y + player.h - 2;

Â  Â  for(const o of obstacles){
Â  Â  Â  const ox1 = o.x + 6, ox2 = o.x + o.w - 6;
Â  Â  Â  const oy1 = o.y + 2, oy2 = o.y + o.h;

Â  Â  Â  const hit = !(px2 < ox1 || px1 > ox2 || py2 < oy1 || py1 > oy2);
Â  Â  Â  if(hit){ endGame(); break; }
Â  Â  }

Â  Â  checkRewards();
Â  }

Â  // draw obstacles
Â  ctx.fillStyle = "#e04646";
Â  for(const o of obstacles){
Â  Â  ctx.fillRect(o.x, o.y, o.w, o.h);
Â  }

Â  // draw player sprite
Â  // row: 0 Ğ±ĞµĞ³ (Ğ²ĞµÑ€Ñ…), 1 Ğ¿Ñ€Ñ‹Ğ¶Ğ¾Ğº (ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ° 1 ĞºĞ°Ğ´Ñ€), 2 ÑĞ¼ĞµÑ€Ñ‚ÑŒ (Ğ½Ğ¸Ğ· 1 ĞºĞ°Ğ´Ñ€)
Â  let row=0, col=0;
Â  if(state === "over"){ row=2; col=0; }
Â  else if(!player.onGround){ row=1; col=0; }
Â  else {
Â  Â  player.animT += dt;
Â  Â  col = Math.floor((player.animT * 10) % 3); // 3 ĞºĞ°Ğ´Ñ€Ğ° Ğ±ĞµĞ³Ğ°
Â  Â  row = 0;
Â  }
Â  drawSprite(row, col, player.x, player.y, player.w, player.h);

Â  requestAnimationFrame(loop);
}

/* init */
resetRun();
requestAnimationFrame(loop);
</script>
</body>
</html>
